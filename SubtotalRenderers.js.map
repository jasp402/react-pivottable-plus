{"version":3,"file":"SubtotalRenderers.js","names":["_react","_interopRequireDefault","require","_propTypes","_Utilities","e","__esModule","_slicedToArray","r","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","l","t","Symbol","iterator","n","i","u","a","f","o","call","next","Object","done","push","value","length","Array","isArray","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","from","_arrayLikeToArray","_createForOfIteratorHelper","_n","F","s","toString","slice","constructor","name","test","_classCallCheck","_defineProperties","enumerable","configurable","writable","defineProperty","_toPropertyKey","key","_createClass","prototype","_toPrimitive","_typeof","toPrimitive","String","Number","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","_setPrototypeOf","redColorScaleGenerator","values","min","Math","max","x","nonRed","round","backgroundColor","concat","makeRenderer","opts","arguments","undefined","SubtotalRenderer","_React$Component","props","_this","state","collapsedRows","collapsedCols","componentDidMount","subtotals","document","getElementById","style","createElement","id","innerHTML","head","appendChild","getBasePivotSettings","_this2","colAttrs","cols","rowAttrs","rows","tableOptions","assign","rowTotals","colTotals","subtotalOptions","arrowCollapsed","arrowExpanded","colSubtotalDisplay","displayOnTop","enabled","hideOnExpand","rowSubtotalDisplay","pivotData","PivotData","rowEnabled","colEnabled","rowPartialOnTop","colPartialOnTop","rowKeys","getRowKeys","colKeys","getColKeys","cellCallbacks","rowTotalCallbacks","colTotalCallbacks","grandTotalCallback","clickCallback","forEach","rowKey","flatRowKey","flatKey","colKey","flatColKey","clickHandler","heatmapMappers","tableColorScaleGenerator","rowValues","colValues","_this3","getAggregator","filters","colLimit","attr","rowLimit","collapseAttr","rowOrCol","attrIdx","allKeys","flatCollapseKeys","k","slicedKey","setState","prevState","expandAttr","toggleRowKey","newCollapsedRows","toggleColKey","newCollapsedCols","calcAttrSpans","attrArr","numAttrs","spans","li","map","lv","cv","isSubtotal","actualCv","ent","depth","limit","renderColHeaderRow","attrName","pivotSettings","visibleColKeys","colAttrSpans","spaceCell","colSpan","rowSpan","needToggle","attrNameCell","className","attrValueCells","rowIncrSpan","isSubtotalCol","actualColKey","onClick","headerText","headerClass","isCollapsedParent","cursor","totalCell","cells","renderRowHeaderRow","renderTableRow","rowIdx","_this4","rowMapper","colMapper","visibleKeys","isSubtotalRow","actualRowKey","aggregator","valCss","needsSubtotalValue","calculateSubtotal","tempAggregator","safeGetAggregator","format","heatmapMode","bgColorFromSubtotalValue","cellColor","bgColorFromRowColKey","val","formattedVal","cellKey","colCellKey","error","totalVal","formattedTotal","agg","isNaN","totalColor","formatFunc","includes","renderTotalsRow","_this5","colTotal","displayValue","grandTotal","validValuesFound","grandTotalAggregator","grandTotalColor","keys","collapsed","sortedKeys","sort","b","minLength","aStr","bStr","cmp","localeCompare","result","processedKeys","Set","_iterator","_step","parentCollapsed","deepestCollapsedParent","parentKey","flatParentKey","has","add","flatKey_","err","finalResult","addedSubtotals","parentGroups","Map","_i2","_result","level","parentKeyStr","set","lastChildIndex","parentGroup","get","subtotalsToAdd","subtotalKey","subtotalKeyStr","getSubtotal","hasSubtotals","attrs","_this6","total","hasValidValues","childRowKeys","fullRowKey","isChild","childColKeys","fullColKey","childRowKey","childColKey","render","_this7","renderedLabels","visibleRowKeys","finalPivotSettings","maxRowVisible","maxColVisible","rowAttrSpans","rowspans","span","j","nextKey","isNextSubtotal","actualNextKey","matches","renderedRows","rowCells","labelKey","join","rowspan","isCollapsed","icon","marginRight","isLeafLevel","leafColspan","dataCells","colAttrsHeaders","rowAttrsHeader","totalHeader","colorScaleGenerator","valueCellColors","rowTotalColors","colTotalColors","allValues","forEachCell","flatRow","flatCol","rowTotal","rowTotalValues","forEachTotal","_ref","_ref2","valKey","_x","rowTotalColorScale","_ref3","_ref4","colTotalValues","_ref5","_ref6","colTotalColorScale","_ref7","_ref8","grandTotalVal","grandTotalColorScale","colorScale","rowColorScales","entries","_ref9","_ref0","colColorScales","_ref1","_ref10","React","Component","defaultProps","propTypes","PropTypes","func","object","TSVExportRenderer","_React$PureComponent","headerRow","aggregatorName","c","row","unshift","width","window","innerWidth","height","innerHeight","readOnly","PureComponent","_default","exports","module","default"],"sources":["src/SubtotalRenderers.jsx"],"sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {PivotData, flatKey} from './Utilities';\r\n\r\nfunction redColorScaleGenerator(values) {\r\n  const min = Math.min.apply(Math, values);\r\n  const max = Math.max.apply(Math, values);\r\n  return x => {\r\n    // eslint-disable-next-line no-magic-numbers\r\n    const nonRed = 255 - Math.round((255 * (x - min)) / (max - min));\r\n    return {backgroundColor: `rgb(255,${nonRed},${nonRed})`};\r\n  };\r\n}\r\n\r\nfunction makeRenderer(opts = {}) {\r\n  class SubtotalRenderer extends React.Component {\r\n    constructor(props) {\r\n      super(props);\r\n      this.state = {collapsedRows: {}, collapsedCols: {}};\r\n    }\r\n\r\n    componentDidMount() {\r\n      if (\r\n        opts.subtotals &&\r\n        !document.getElementById('react-pivottable-subtotal-styles')\r\n      ) {\r\n        const style = document.createElement('style');\r\n        style.id = 'react-pivottable-subtotal-styles';\r\n        style.innerHTML = `\r\n          .pvtSubtotal {\r\n            font-weight: bold;\r\n            background-color: #f0f0f0;\r\n          }\r\n          .pvtSubtotalRow {\r\n            border-top: 1px solid #ddd;\r\n          }\r\n          .pvtSubtotalVal {\r\n            color: #777;\r\n            font-style: italic;\r\n          }\r\n        `;\r\n        document.head.appendChild(style);\r\n      }\r\n    }\r\n\r\n    getBasePivotSettings() {\r\n      const props = this.props;\r\n      const colAttrs = props.cols;\r\n      const rowAttrs = props.rows;\r\n\r\n      const tableOptions = Object.assign(\r\n        {\r\n          rowTotals: true,\r\n          colTotals: true,\r\n        },\r\n        props.tableOptions\r\n      );\r\n      const rowTotals = tableOptions.rowTotals || colAttrs.length === 0;\r\n      const colTotals = tableOptions.colTotals || rowAttrs.length === 0;\r\n\r\n      const subtotalOptions = Object.assign(\r\n        {\r\n          arrowCollapsed: '\\u25B6',\r\n          arrowExpanded: '\\u25E2',\r\n        },\r\n        props.subtotalOptions\r\n      );\r\n\r\n      const colSubtotalDisplay = Object.assign(\r\n        {\r\n          displayOnTop: false,\r\n          enabled: rowTotals,\r\n          hideOnExpand: false,\r\n        },\r\n        subtotalOptions.colSubtotalDisplay\r\n      );\r\n\r\n      const rowSubtotalDisplay = Object.assign(\r\n        {\r\n          displayOnTop: true,\r\n          enabled: colTotals,\r\n          hideOnExpand: false,\r\n        },\r\n        subtotalOptions.rowSubtotalDisplay\r\n      );\r\n\r\n      const pivotData = new PivotData(\r\n        props,\r\n        !opts.subtotals\r\n          ? {}\r\n          : {\r\n              rowEnabled: rowSubtotalDisplay.enabled,\r\n              colEnabled: colSubtotalDisplay.enabled,\r\n              rowPartialOnTop: rowSubtotalDisplay.displayOnTop,\r\n              colPartialOnTop: colSubtotalDisplay.displayOnTop,\r\n            }\r\n      );\r\n      const rowKeys = pivotData.getRowKeys();\r\n      const colKeys = pivotData.getColKeys();\r\n\r\n      const cellCallbacks = {};\r\n      const rowTotalCallbacks = {};\r\n      const colTotalCallbacks = {};\r\n      let grandTotalCallback = null;\r\n      if (tableOptions.clickCallback) {\r\n        rowKeys.forEach(rowKey => {\r\n          const flatRowKey = flatKey(rowKey);\r\n          cellCallbacks[flatRowKey] = {};\r\n          colKeys.forEach(colKey => {\r\n            const flatColKey = flatKey(colKey);\r\n            if (!(flatRowKey in cellCallbacks)) {\r\n              cellCallbacks[flatRowKey] = {};\r\n            }\r\n            cellCallbacks[flatRowKey][flatColKey] = this.clickHandler(\r\n              pivotData,\r\n              rowKey,\r\n              colKey\r\n            );\r\n          });\r\n          rowTotalCallbacks[flatRowKey] = this.clickHandler(\r\n            pivotData,\r\n            rowKey,\r\n            []\r\n          );\r\n        });\r\n        colKeys.forEach(colKey => {\r\n          const flatColKey = flatKey(colKey);\r\n          colTotalCallbacks[flatColKey] = this.clickHandler(\r\n            pivotData,\r\n            [],\r\n            colKey\r\n          );\r\n        });\r\n        grandTotalCallback = this.clickHandler(pivotData, [], []);\r\n      }\r\n\r\n      return Object.assign(\r\n        {\r\n          pivotData,\r\n          colAttrs,\r\n          rowAttrs,\r\n          colKeys,\r\n          rowKeys,\r\n          rowTotals,\r\n          colTotals,\r\n          arrowCollapsed: subtotalOptions.arrowCollapsed,\r\n          arrowExpanded: subtotalOptions.arrowExpanded,\r\n          colSubtotalDisplay,\r\n          rowSubtotalDisplay,\r\n          cellCallbacks,\r\n          rowTotalCallbacks,\r\n          colTotalCallbacks,\r\n          grandTotalCallback,\r\n        },\r\n        SubtotalRenderer.heatmapMappers(\r\n          pivotData,\r\n          props.tableColorScaleGenerator,\r\n          colTotals,\r\n          rowTotals\r\n        )\r\n      );\r\n    }\r\n\r\n    clickHandler(pivotData, rowValues, colValues) {\r\n      const colAttrs = this.props.cols;\r\n      const rowAttrs = this.props.rows;\r\n      const value = pivotData.getAggregator(rowValues, colValues).value();\r\n      const filters = {};\r\n      const colLimit = Math.min(colAttrs.length, colValues.length);\r\n      for (let i = 0; i < colLimit; i++) {\r\n        const attr = colAttrs[i];\r\n        if (colValues[i] !== null) {\r\n          filters[attr] = colValues[i];\r\n        }\r\n      }\r\n      const rowLimit = Math.min(rowAttrs.length, rowValues.length);\r\n      for (let i = 0; i < rowLimit; i++) {\r\n        const attr = rowAttrs[i];\r\n        if (rowValues[i] !== null) {\r\n          filters[attr] = rowValues[i];\r\n        }\r\n      }\r\n      return e =>\r\n        this.props.tableOptions.clickCallback(e, value, filters, pivotData);\r\n    }\r\n\r\n    collapseAttr(rowOrCol, attrIdx, allKeys) {\r\n      return function() {\r\n        var flatCollapseKeys = {};\r\n        for (var i = 0; i < allKeys.length; i++) {\r\n          var k = allKeys[i];\r\n          var slicedKey = k.slice(0, attrIdx + 1);\r\n          flatCollapseKeys[flatKey(slicedKey)] = true;\r\n        }\r\n        this.setState(function(prevState) {\r\n          if (rowOrCol === 'row') {\r\n            return {\r\n              collapsedRows: Object.assign(\r\n                {},\r\n                prevState.collapsedRows,\r\n                flatCollapseKeys\r\n              ),\r\n            };\r\n          } else if (rowOrCol === 'col') {\r\n            return {\r\n              collapsedCols: Object.assign(\r\n                {},\r\n                prevState.collapsedCols,\r\n                flatCollapseKeys\r\n              ),\r\n            };\r\n          }\r\n          return null;\r\n        });\r\n      }.bind(this);\r\n    }\r\n\r\n    expandAttr(rowOrCol, attrIdx, allKeys) {\r\n      return function() {\r\n        var flatCollapseKeys = {};\r\n        for (var i = 0; i < allKeys.length; i++) {\r\n          var k = allKeys[i];\r\n          var slicedKey = k.slice(0, attrIdx + 1);\r\n          flatCollapseKeys[flatKey(slicedKey)] = false;\r\n        }\r\n        this.setState(function(prevState) {\r\n          if (rowOrCol === 'row') {\r\n            return {\r\n              collapsedRows: Object.assign(\r\n                {},\r\n                prevState.collapsedRows,\r\n                flatCollapseKeys\r\n              ),\r\n            };\r\n          } else if (rowOrCol === 'col') {\r\n            return {\r\n              collapsedCols: Object.assign(\r\n                {},\r\n                prevState.collapsedCols,\r\n                flatCollapseKeys\r\n              ),\r\n            };\r\n          }\r\n          return null;\r\n        });\r\n      }.bind(this);\r\n    }\r\n\r\n    toggleRowKey(flatRowKey) {\r\n      return function() {\r\n        this.setState(function(prevState) {\r\n          var newCollapsedRows = Object.assign({}, prevState.collapsedRows);\r\n          newCollapsedRows[flatRowKey] = !prevState.collapsedRows[flatRowKey];\r\n          return {collapsedRows: newCollapsedRows};\r\n        });\r\n      }.bind(this);\r\n    }\r\n\r\n    toggleColKey(flatColKey) {\r\n      return function() {\r\n        this.setState(function(prevState) {\r\n          var newCollapsedCols = Object.assign({}, prevState.collapsedCols);\r\n          newCollapsedCols[flatColKey] = !prevState.collapsedCols[flatColKey];\r\n          return {collapsedCols: newCollapsedCols};\r\n        });\r\n      }.bind(this);\r\n    }\r\n\r\n    // Given an array of attribute values (i.e. each element is another array with\r\n    // the value at every level), compute the spans for every attribute value at\r\n    // each level.\r\n    calcAttrSpans(attrArr, numAttrs) {\r\n      const spans = [];\r\n      const li = Array(numAttrs).map(() => 0);\r\n      let lv = Array(numAttrs).map(() => null);\r\n      for (let i = 0; i < attrArr.length; i++) {\r\n        const cv = attrArr[i];\r\n        const isSubtotal = cv[cv.length - 1] === '__subtotal__';\r\n        const actualCv = isSubtotal ? cv.slice(0, -1) : cv;\r\n\r\n        const ent = [];\r\n        let depth = 0;\r\n        const limit = Math.min(lv.length, actualCv.length);\r\n        while (depth < limit && lv[depth] === actualCv[depth]) {\r\n          ent.push(-1);\r\n          spans[li[depth]][depth]++;\r\n          depth++;\r\n        }\r\n        while (depth < actualCv.length) {\r\n          li[depth] = i;\r\n          ent.push(1);\r\n          depth++;\r\n        }\r\n        spans.push(ent);\r\n        lv = actualCv;\r\n      }\r\n      return spans;\r\n    }\r\n\r\n    static heatmapMappers(\r\n      pivotData,\r\n      colorScaleGenerator,\r\n      colTotals,\r\n      rowTotals\r\n    ) {\r\n      const colMapper = {};\r\n      const rowMapper = {};\r\n\r\n      if (colorScaleGenerator && opts.heatmapMode) {\r\n        const valueCellColors = {};\r\n        const rowTotalColors = {};\r\n        const colTotalColors = {};\r\n        let grandTotalColor = null;\r\n\r\n        const allValues = [];\r\n        const rowValues = {};\r\n        const colValues = {};\r\n\r\n        pivotData.forEachCell((val, rowKey, colKey) => {\r\n          if (val !== null && !isNaN(val)) {\r\n            allValues.push(val);\r\n\r\n            const flatRow = flatKey(rowKey);\r\n            if (!rowValues[flatRow]) {\r\n              rowValues[flatRow] = [];\r\n            }\r\n            rowValues[flatRow].push(val);\r\n\r\n            const flatCol = flatKey(colKey);\r\n            if (!colValues[flatCol]) {\r\n              colValues[flatCol] = [];\r\n            }\r\n            colValues[flatCol].push(val);\r\n          }\r\n        });\r\n\r\n        if (opts.heatmapMode === 'row' && colTotals) {\r\n          pivotData.getRowKeys().forEach(rowKey => {\r\n            let rowTotal = 0;\r\n            let hasValidValues = false;\r\n            pivotData.getColKeys().forEach(colKey => {\r\n              const agg = pivotData.getAggregator(rowKey, colKey);\r\n              if (agg) {\r\n                const val = agg.value();\r\n                if (val !== null && !isNaN(val)) {\r\n                  rowTotal += val;\r\n                  hasValidValues = true;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (hasValidValues && rowTotal !== 0) {\r\n              const flatRow = flatKey(rowKey);\r\n              if (!rowValues[flatRow]) {\r\n                rowValues[flatRow] = [];\r\n              }\r\n              rowValues[flatRow].push(rowTotal);\r\n            }\r\n          });\r\n        }\r\n\r\n        if (opts.heatmapMode === 'col' && rowTotals) {\r\n          pivotData.getColKeys().forEach(colKey => {\r\n            let colTotal = 0;\r\n            let hasValidValues = false;\r\n            pivotData.getRowKeys().forEach(rowKey => {\r\n              const agg = pivotData.getAggregator(rowKey, colKey);\r\n              if (agg) {\r\n                const val = agg.value();\r\n                if (val !== null && !isNaN(val)) {\r\n                  colTotal += val;\r\n                  hasValidValues = true;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (hasValidValues && colTotal !== 0) {\r\n              const flatCol = flatKey(colKey);\r\n              if (!colValues[flatCol]) {\r\n                colValues[flatCol] = [];\r\n              }\r\n              colValues[flatCol].push(colTotal);\r\n            }\r\n          });\r\n        }\r\n\r\n        if (colTotals) {\r\n          const rowTotalValues = [];\r\n          pivotData.forEachTotal(([valKey, _x]) => {\r\n            const val = pivotData.getAggregator([valKey], []).value();\r\n            if (val !== null && !isNaN(val)) {\r\n              rowTotalValues.push(val);\r\n              if (opts.heatmapMode === 'full') {\r\n                allValues.push(val);\r\n              }\r\n            }\r\n          });\r\n\r\n          const rowTotalColorScale =\r\n            opts.heatmapMode === 'full'\r\n              ? colorScaleGenerator(allValues)\r\n              : colorScaleGenerator(rowTotalValues);\r\n\r\n          pivotData.forEachTotal(([valKey, _x]) => {\r\n            const val = pivotData.getAggregator([valKey], []).value();\r\n            if (val !== null && !isNaN(val)) {\r\n              rowTotalColors[flatKey([valKey])] = rowTotalColorScale(val);\r\n            }\r\n          });\r\n        }\r\n\r\n        if (rowTotals) {\r\n          const colTotalValues = [];\r\n          pivotData.forEachTotal(([_x, valKey]) => {\r\n            const val = pivotData.getAggregator([], [valKey]).value();\r\n            if (val !== null && !isNaN(val)) {\r\n              colTotalValues.push(val);\r\n              if (opts.heatmapMode === 'full') {\r\n                allValues.push(val);\r\n              }\r\n            }\r\n          });\r\n\r\n          const colTotalColorScale =\r\n            opts.heatmapMode === 'full'\r\n              ? colorScaleGenerator(allValues)\r\n              : colorScaleGenerator(colTotalValues);\r\n\r\n          pivotData.forEachTotal(([_x, valKey]) => {\r\n            const val = pivotData.getAggregator([], [valKey]).value();\r\n            if (val !== null && !isNaN(val)) {\r\n              colTotalColors[flatKey([valKey])] = colTotalColorScale(val);\r\n            }\r\n          });\r\n        }\r\n\r\n        if (colTotals && rowTotals) {\r\n          const grandTotalVal = pivotData.getAggregator([], []).value();\r\n          if (grandTotalVal !== null && !isNaN(grandTotalVal)) {\r\n            if (opts.heatmapMode === 'full') {\r\n              allValues.push(grandTotalVal);\r\n              const grandTotalColorScale = colorScaleGenerator(allValues);\r\n              grandTotalColor = grandTotalColorScale(grandTotalVal);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (rowTotals) {\r\n          colMapper.totalColor = key => colTotalColors[flatKey([key])];\r\n        }\r\n        if (colTotals) {\r\n          rowMapper.totalColor = key => rowTotalColors[flatKey([key])];\r\n        }\r\n        if (grandTotalColor) {\r\n          colMapper.grandTotalColor = grandTotalColor;\r\n        }\r\n\r\n        if (opts.heatmapMode === 'full') {\r\n          // Full heatmap: Compare values across the entire table\r\n          // Note: allValues already contains all cell values from earlier collection\r\n          const colorScale = colorScaleGenerator(allValues);\r\n          pivotData.forEachCell((val, rowKey, colKey) => {\r\n            if (val !== null && !isNaN(val)) {\r\n              valueCellColors[\r\n                `${flatKey(rowKey)}_${flatKey(colKey)}`\r\n              ] = colorScale(val);\r\n            }\r\n          });\r\n\r\n          colMapper.bgColorFromRowColKey = (rowKey, colKey) =>\r\n            valueCellColors[`${flatKey(rowKey)}_${flatKey(colKey)}`];\r\n\r\n          colMapper.bgColorFromSubtotalValue = value => {\r\n            if (value !== null && !isNaN(value)) {\r\n              return colorScale(value);\r\n            }\r\n            return null;\r\n          };\r\n        } else if (opts.heatmapMode === 'row') {\r\n          // Row heatmap: Compare values within each row\r\n          // Note: rowValues already populated from earlier collection\r\n          const rowColorScales = {};\r\n          Object.entries(rowValues).forEach(([flatRow, values]) => {\r\n            if (values.length > 0) {\r\n              rowColorScales[flatRow] = colorScaleGenerator(values);\r\n            }\r\n          });\r\n\r\n          pivotData.forEachCell((val, rowKey, colKey) => {\r\n            const flatRow = flatKey(rowKey);\r\n            if (val !== null && !isNaN(val) && rowColorScales[flatRow]) {\r\n              valueCellColors[`${flatRow}_${flatKey(colKey)}`] = rowColorScales[\r\n                flatRow\r\n              ](val);\r\n            }\r\n          });\r\n\r\n          colMapper.bgColorFromRowColKey = (rowKey, colKey) =>\r\n            valueCellColors[`${flatKey(rowKey)}_${flatKey(colKey)}`];\r\n\r\n          colMapper.bgColorFromSubtotalValue = (value, rowKey) => {\r\n            if (value !== null && !isNaN(value)) {\r\n              const flatRow = flatKey(rowKey);\r\n              if (rowColorScales[flatRow]) {\r\n                return rowColorScales[flatRow](value);\r\n              }\r\n            }\r\n            return null;\r\n          };\r\n        } else if (opts.heatmapMode === 'col') {\r\n          // Column heatmap: Compare values within each column\r\n          // Note: colValues already populated from earlier collection\r\n          const colColorScales = {};\r\n          Object.entries(colValues).forEach(([flatCol, values]) => {\r\n            if (values.length > 0) {\r\n              colColorScales[flatCol] = colorScaleGenerator(values);\r\n            }\r\n          });\r\n\r\n          pivotData.forEachCell((val, rowKey, colKey) => {\r\n            const flatCol = flatKey(colKey);\r\n            if (val !== null && !isNaN(val) && colColorScales[flatCol]) {\r\n              valueCellColors[`${flatKey(rowKey)}_${flatCol}`] = colColorScales[\r\n                flatCol\r\n              ](val);\r\n            }\r\n          });\r\n\r\n          colMapper.bgColorFromRowColKey = (rowKey, colKey) =>\r\n            valueCellColors[`${flatKey(rowKey)}_${flatKey(colKey)}`];\r\n\r\n          colMapper.bgColorFromSubtotalValue = (value, rowKey, colKey) => {\r\n            if (value !== null && !isNaN(value)) {\r\n              const flatCol = flatKey(colKey);\r\n              if (colColorScales[flatCol]) {\r\n                return colColorScales[flatCol](value);\r\n              }\r\n            }\r\n            return null;\r\n          };\r\n        }\r\n      }\r\n      return {colMapper, rowMapper};\r\n    }\r\n\r\n    renderColHeaderRow(attrName, attrIdx, pivotSettings) {\r\n      const {\r\n        rowAttrs,\r\n        colAttrs,\r\n        visibleColKeys,\r\n        colAttrSpans,\r\n        rowTotals,\r\n        arrowExpanded,\r\n        arrowCollapsed,\r\n        colSubtotalDisplay,\r\n      } = pivotSettings;\r\n\r\n      const spaceCell =\r\n        attrIdx === 0 && rowAttrs.length !== 0 ? (\r\n          <th\r\n            key=\"padding\"\r\n            colSpan={rowAttrs.length}\r\n            rowSpan={colAttrs.length}\r\n          />\r\n        ) : null;\r\n\r\n      const needToggle =\r\n        opts.subtotals &&\r\n        colSubtotalDisplay.enabled &&\r\n        attrIdx !== colAttrs.length - 1;\r\n      const attrNameCell = (\r\n        <th key=\"label\" className=\"pvtAxisLabel\">\r\n          {attrName}\r\n        </th>\r\n      );\r\n\r\n      const attrValueCells = [];\r\n      const rowIncrSpan = rowAttrs.length !== 0 ? 1 : 0;\r\n      let i = 0;\r\n      while (i < visibleColKeys.length) {\r\n        const colKey = visibleColKeys[i];\r\n        const isSubtotalCol = colKey[colKey.length - 1] === '__subtotal__';\r\n        const actualColKey = isSubtotalCol ? colKey.slice(0, -1) : colKey;\r\n\r\n        const colSpan =\r\n          attrIdx < actualColKey.length ? colAttrSpans[i][attrIdx] : 1;\r\n        if (attrIdx < actualColKey.length) {\r\n          const rowSpan =\r\n            1 + (attrIdx === colAttrs.length - 1 ? rowIncrSpan : 0);\r\n          const flatColKey = flatKey(actualColKey.slice(0, attrIdx + 1));\r\n          const onClick = needToggle ? this.toggleColKey(flatColKey) : null;\r\n\r\n          let headerText = actualColKey[attrIdx];\r\n          let headerClass = 'pvtColLabel';\r\n\r\n          const isCollapsedParent =\r\n            this.state.collapsedCols[flatColKey] &&\r\n            actualColKey.length < colAttrs.length;\r\n\r\n          if (isSubtotalCol) {\r\n            headerText = `${headerText} (Subtotal)`;\r\n            headerClass += ' pvtSubtotal';\r\n          } else if (isCollapsedParent) {\r\n            headerClass += ' pvtSubtotal';\r\n          }\r\n\r\n          attrValueCells.push(\r\n            <th\r\n              className={headerClass}\r\n              key={'colKey-' + flatColKey + (isSubtotalCol ? '-subtotal' : '')}\r\n              colSpan={colSpan}\r\n              rowSpan={rowSpan}\r\n              onClick={onClick}\r\n              style={{cursor: needToggle ? 'pointer' : 'default'}}\r\n            >\r\n              {needToggle\r\n                ? (this.state.collapsedCols[flatColKey]\r\n                    ? arrowCollapsed\r\n                    : arrowExpanded) + ' '\r\n                : null}\r\n              {headerText}\r\n            </th>\r\n          );\r\n        } else if (attrIdx === actualColKey.length) {\r\n          const rowSpan = colAttrs.length - actualColKey.length + rowIncrSpan;\r\n          const flatColKey = flatKey(actualColKey);\r\n          const isCollapsedParent =\r\n            this.state.collapsedCols[flatColKey] &&\r\n            actualColKey.length < colAttrs.length;\r\n\r\n          attrValueCells.push(\r\n            <th\r\n              className={`pvtColLabel ${\r\n                isSubtotalCol || isCollapsedParent ? 'pvtSubtotal' : ''\r\n              }`}\r\n              key={\r\n                'colKeyBuffer-' +\r\n                flatKey(actualColKey) +\r\n                (isSubtotalCol ? '-subtotal' : '')\r\n              }\r\n              colSpan={colSpan}\r\n              rowSpan={rowSpan}\r\n            />\r\n          );\r\n        }\r\n        i = i + colSpan;\r\n      }\r\n\r\n      const totalCell =\r\n        attrIdx === 0 && rowTotals ? (\r\n          <th\r\n            key=\"total\"\r\n            className=\"pvtTotalLabel\"\r\n            rowSpan={colAttrs.length + Math.min(rowAttrs.length, 1)}\r\n          >\r\n            Totals\r\n          </th>\r\n        ) : null;\r\n\r\n      const cells = [spaceCell, attrNameCell, ...attrValueCells, totalCell];\r\n      return cells;\r\n    }\r\n\r\n    renderRowHeaderRow(pivotSettings) {\r\n      const {colAttrs, rowAttrs} = pivotSettings;\r\n      const cells = [];\r\n      if (rowAttrs.length !== 0) {\r\n        rowAttrs.map(function(r, i) {\r\n          cells.push(\r\n            <th className=\"pvtAxisLabel\" key={`rowAttr${i}`}>\r\n              {r}\r\n            </th>\r\n          );\r\n        });\r\n        cells.push(\r\n          <th className=\"pvtTotalLabel\" key=\"total\">\r\n            {colAttrs.length === 0 ? 'Totals' : null}\r\n          </th>\r\n        );\r\n      }\r\n      return cells;\r\n    }\r\n\r\n    renderTableRow(rowKey, rowIdx, pivotSettings) {\r\n      const {\r\n        colKeys,\r\n        rowAttrs,\r\n        colAttrs,\r\n        rowTotals,\r\n        pivotData,\r\n        rowMapper,\r\n        colMapper,\r\n        cellCallbacks,\r\n        rowTotalCallbacks,\r\n      } = pivotSettings;\r\n\r\n      const visibleColKeys = this.visibleKeys(\r\n        colKeys,\r\n        this.state.collapsedCols\r\n      );\r\n\r\n      const cells = [];\r\n      const isSubtotalRow = rowKey[rowKey.length - 1] === '__subtotal__';\r\n      const actualRowKey = isSubtotalRow ? rowKey.slice(0, -1) : rowKey;\r\n\r\n      visibleColKeys.forEach((colKey, i) => {\r\n        try {\r\n          if (!actualRowKey || !colKey) {\r\n            cells.push(<td className=\"pvtVal\" key={`pvtVal-${i}`} />);\r\n            return;\r\n          }\r\n\r\n          let aggregator,\r\n            className,\r\n            valCss = {};\r\n\r\n          const isSubtotalCol = colKey[colKey.length - 1] === '__subtotal__';\r\n          const actualColKey = isSubtotalCol ? colKey.slice(0, -1) : colKey;\r\n\r\n          const needsSubtotalValue =\r\n            isSubtotalRow ||\r\n            isSubtotalCol ||\r\n            (actualColKey.length < colAttrs.length &&\r\n              this.state.collapsedCols[flatKey(actualColKey)]) ||\r\n            (actualRowKey.length < rowAttrs.length &&\r\n              this.state.collapsedRows[flatKey(actualRowKey)]);\r\n\r\n          if (needsSubtotalValue) {\r\n            const value = this.calculateSubtotal(\r\n              pivotData,\r\n              actualRowKey,\r\n              actualColKey,\r\n              pivotSettings\r\n            );\r\n            className = 'pvtSubtotal';\r\n\r\n            const tempAggregator = this.safeGetAggregator(pivotData, [], []);\r\n            aggregator = {\r\n              value: () => value,\r\n              format: tempAggregator ? tempAggregator.format : x => x,\r\n            };\r\n\r\n            if (opts.heatmapMode && colMapper.bgColorFromSubtotalValue) {\r\n              let cellColor;\r\n              if (opts.heatmapMode === 'full') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(value);\r\n              } else if (opts.heatmapMode === 'row') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  value,\r\n                  actualRowKey\r\n                );\r\n              } else if (opts.heatmapMode === 'col') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  value,\r\n                  actualRowKey,\r\n                  actualColKey\r\n                );\r\n              }\r\n\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          } else {\r\n            aggregator = this.safeGetAggregator(\r\n              pivotData,\r\n              actualRowKey,\r\n              actualColKey\r\n            );\r\n            className = 'pvtVal';\r\n\r\n            if (opts.heatmapMode && colMapper.bgColorFromRowColKey) {\r\n              const cellColor = colMapper.bgColorFromRowColKey(\r\n                actualRowKey,\r\n                actualColKey\r\n              );\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          }\r\n\r\n          if (!aggregator || aggregator.value() === null) {\r\n            cells.push(\r\n              <td className={className} key={`pvtVal-${i}`} style={valCss} />\r\n            );\r\n            return;\r\n          }\r\n\r\n          const val = aggregator.value();\r\n\r\n          let formattedVal;\r\n          if (val === null) {\r\n            formattedVal = '';\r\n          } else if (className === 'pvtSubtotal' && val === 0) {\r\n            formattedVal = '';\r\n          } else {\r\n            formattedVal = aggregator.format(val);\r\n          }\r\n\r\n          const cellKey = flatKey(actualRowKey);\r\n          const colCellKey = flatKey(actualColKey);\r\n\r\n          cells.push(\r\n            <td\r\n              className={className}\r\n              key={`pvtVal-${i}`}\r\n              style={valCss}\r\n              onClick={\r\n                cellCallbacks[cellKey] && colCellKey in cellCallbacks[cellKey]\r\n                  ? cellCallbacks[cellKey][colCellKey]\r\n                  : null\r\n              }\r\n            >\r\n              {formattedVal}\r\n            </td>\r\n          );\r\n        } catch (error) {\r\n          cells.push(<td className=\"pvtVal\" key={`pvtVal-${i}`} />);\r\n        }\r\n      });\r\n\r\n      if (rowTotals) {\r\n        try {\r\n          const className = isSubtotalRow ? 'pvtTotal pvtSubtotal' : 'pvtTotal';\r\n          let valCss = {};\r\n\r\n          let totalVal = 0;\r\n          let formattedTotal = '';\r\n\r\n          if (isSubtotalRow) {\r\n            totalVal = this.calculateSubtotal(\r\n              pivotData,\r\n              actualRowKey,\r\n              [],\r\n              pivotSettings\r\n            );\r\n\r\n            if (opts.heatmapMode && colMapper.bgColorFromSubtotalValue) {\r\n              let cellColor;\r\n              if (opts.heatmapMode === 'full') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(totalVal);\r\n              } else if (opts.heatmapMode === 'row') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey\r\n                );\r\n              } else if (opts.heatmapMode === 'col') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey,\r\n                  []\r\n                );\r\n              }\r\n\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          } else if (\r\n            actualRowKey.length < rowAttrs.length &&\r\n            this.state.collapsedRows[flatKey(actualRowKey)]\r\n          ) {\r\n            totalVal = this.calculateSubtotal(\r\n              pivotData,\r\n              actualRowKey,\r\n              [],\r\n              pivotSettings\r\n            );\r\n\r\n            if (opts.heatmapMode && colMapper.bgColorFromSubtotalValue) {\r\n              let cellColor;\r\n              if (opts.heatmapMode === 'full') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(totalVal);\r\n              } else if (opts.heatmapMode === 'row') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey\r\n                );\r\n              } else if (opts.heatmapMode === 'col') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey,\r\n                  []\r\n                );\r\n              }\r\n\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          } else {\r\n            pivotData.getColKeys().forEach(colKey => {\r\n              const agg = this.safeGetAggregator(\r\n                pivotData,\r\n                actualRowKey,\r\n                colKey\r\n              );\r\n              if (agg) {\r\n                const val = agg.value();\r\n                if (val !== null && !isNaN(val)) {\r\n                  totalVal += val;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (opts.heatmapMode && totalVal !== 0) {\r\n              if (\r\n                opts.heatmapMode === 'row' &&\r\n                colMapper.bgColorFromSubtotalValue\r\n              ) {\r\n                const cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey\r\n                );\r\n                if (cellColor) {\r\n                  valCss = cellColor;\r\n                }\r\n              } else if (rowMapper.totalColor) {\r\n                const cellColor = rowMapper.totalColor(actualRowKey[0]);\r\n                if (cellColor) {\r\n                  valCss = cellColor;\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          if (totalVal !== 0 || isSubtotalRow) {\r\n            const tempAggregator = this.safeGetAggregator(pivotData, [], []);\r\n            const formatFunc =\r\n              tempAggregator && tempAggregator.format\r\n                ? tempAggregator.format\r\n                : x => x;\r\n            if (className.includes('pvtSubtotal') && totalVal === 0) {\r\n              formattedTotal = '';\r\n            } else {\r\n              formattedTotal =\r\n                totalVal === null || totalVal === 0 ? '' : formatFunc(totalVal);\r\n            }\r\n          }\r\n\r\n          const cellKey = flatKey(actualRowKey);\r\n\r\n          cells.push(\r\n            <td\r\n              className={className}\r\n              key=\"total\"\r\n              style={valCss}\r\n              onClick={rowTotalCallbacks[cellKey]}\r\n            >\r\n              {formattedTotal}\r\n            </td>\r\n          );\r\n        } catch (error) {\r\n          cells.push(<td className=\"pvtTotal\" key=\"total\" />);\r\n        }\r\n      }\r\n\r\n      return cells;\r\n    }\r\n\r\n    renderTotalsRow(pivotSettings) {\r\n      const {\r\n        colKeys,\r\n        colAttrs,\r\n        rowAttrs,\r\n        colTotals,\r\n        pivotData,\r\n        colMapper,\r\n        grandTotalCallback,\r\n        colTotalCallbacks,\r\n      } = pivotSettings;\r\n\r\n      const visibleColKeys = this.visibleKeys(\r\n        colKeys,\r\n        this.state.collapsedCols\r\n      );\r\n\r\n      const cells = [];\r\n      cells.push(\r\n        <th\r\n          key=\"labelTotal\"\r\n          className=\"pvtTotalLabel\"\r\n          colSpan={rowAttrs.length + (colAttrs.length === 0 ? 0 : 1)}\r\n        >\r\n          Totals\r\n        </th>\r\n      );\r\n\r\n      visibleColKeys.forEach((colKey, i) => {\r\n        try {\r\n          const isSubtotalCol = colKey[colKey.length - 1] === '__subtotal__';\r\n          const actualColKey = isSubtotalCol ? colKey.slice(0, -1) : colKey;\r\n\r\n          if (!actualColKey) {\r\n            cells.push(<td className=\"pvtTotal\" key={`total-${i}`} />);\r\n            return;\r\n          }\r\n\r\n          let colTotal = 0;\r\n\r\n          const flatColKey = flatKey(actualColKey);\r\n          const isCollapsedParent =\r\n            this.state.collapsedCols[flatColKey] &&\r\n            actualColKey.length < colAttrs.length;\r\n\r\n          if (isSubtotalCol || isCollapsedParent) {\r\n            colTotal = this.calculateSubtotal(\r\n              pivotData,\r\n              [],\r\n              actualColKey,\r\n              pivotSettings\r\n            );\r\n          } else {\r\n            pivotData.getRowKeys().forEach(rowKey => {\r\n              const agg = this.safeGetAggregator(\r\n                pivotData,\r\n                rowKey,\r\n                actualColKey\r\n              );\r\n              if (agg) {\r\n                const val = agg.value();\r\n                if (val !== null && !isNaN(val)) {\r\n                  colTotal += val;\r\n                }\r\n              }\r\n            });\r\n          }\r\n\r\n          let valCss = {};\r\n          if (isSubtotalCol || isCollapsedParent) {\r\n            if (opts.heatmapMode && colMapper.bgColorFromSubtotalValue) {\r\n              let cellColor;\r\n              if (opts.heatmapMode === 'full') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(colTotal);\r\n              } else if (opts.heatmapMode === 'row') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(colTotal, []);\r\n              } else if (opts.heatmapMode === 'col') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  colTotal,\r\n                  [],\r\n                  actualColKey\r\n                );\r\n              }\r\n\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          } else {\r\n            if (opts.heatmapMode && colTotal !== 0) {\r\n              if (\r\n                opts.heatmapMode === 'col' &&\r\n                colMapper.bgColorFromSubtotalValue\r\n              ) {\r\n                const cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  colTotal,\r\n                  [],\r\n                  actualColKey\r\n                );\r\n                if (cellColor) {\r\n                  valCss = cellColor;\r\n                }\r\n              } else if (colMapper.totalColor) {\r\n                const cellColor = colMapper.totalColor(actualColKey[0]);\r\n                if (cellColor) {\r\n                  valCss = cellColor;\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          const tempAggregator = this.safeGetAggregator(pivotData, [], []);\r\n          const format =\r\n            tempAggregator && tempAggregator.format\r\n              ? tempAggregator.format\r\n              : x => x;\r\n\r\n          let displayValue;\r\n          if (colTotal === null || colTotal === 0) {\r\n            displayValue = '';\r\n          } else {\r\n            displayValue = format ? format(colTotal) : colTotal;\r\n          }\r\n\r\n          cells.push(\r\n            <td\r\n              className={`pvtTotal ${\r\n                isSubtotalCol || isCollapsedParent ? 'pvtSubtotal' : ''\r\n              }`}\r\n              key={`total-${i}`}\r\n              style={valCss}\r\n              onClick={colTotalCallbacks[flatKey(actualColKey)]}\r\n            >\r\n              {displayValue}\r\n            </td>\r\n          );\r\n        } catch (error) {\r\n          cells.push(<td className=\"pvtTotal\" key={`total-${i}`} />);\r\n        }\r\n      });\r\n\r\n      if (colTotals) {\r\n        try {\r\n          let grandTotal = 0;\r\n          let validValuesFound = false;\r\n\r\n          try {\r\n            const grandTotalAggregator = pivotData.getAggregator([], []);\r\n            if (grandTotalAggregator) {\r\n              const val = grandTotalAggregator.value();\r\n              if (val !== null && !isNaN(val)) {\r\n                grandTotal = val;\r\n                validValuesFound = true;\r\n              }\r\n            }\r\n          } catch (e) {\r\n            // Error getting grand total directly, will calculate manually\r\n          }\r\n\r\n          if (!validValuesFound) {\r\n            pivotData.getRowKeys().forEach(rowKey => {\r\n              pivotData.getColKeys().forEach(colKey => {\r\n                try {\r\n                  const agg = this.safeGetAggregator(pivotData, rowKey, colKey);\r\n                  if (agg) {\r\n                    const val = agg.value();\r\n                    if (val !== null && !isNaN(val)) {\r\n                      grandTotal += val;\r\n                      validValuesFound = true;\r\n                    }\r\n                  }\r\n                } catch (e) {\r\n                  // Ignore errors for missing combinations\r\n                }\r\n              });\r\n            });\r\n          }\r\n\r\n          const tempAggregator = this.safeGetAggregator(pivotData, [], []);\r\n          const format =\r\n            tempAggregator && tempAggregator.format\r\n              ? tempAggregator.format\r\n              : x => x;\r\n\r\n          cells.push(\r\n            <td\r\n              className=\"pvtGrandTotal\"\r\n              key=\"grandTotal\"\r\n              style={\r\n                opts.heatmapMode && colMapper.grandTotalColor\r\n                  ? colMapper.grandTotalColor\r\n                  : {}\r\n              }\r\n              onClick={grandTotalCallback}\r\n            >\r\n              {validValuesFound && grandTotal !== 0\r\n                ? format\r\n                  ? format(grandTotal)\r\n                  : grandTotal\r\n                : ''}\r\n            </td>\r\n          );\r\n        } catch (error) {\r\n          cells.push(<td className=\"pvtGrandTotal\" key=\"grandTotal\" />);\r\n        }\r\n      }\r\n\r\n      return cells;\r\n    }\r\n\r\n    visibleKeys(keys, collapsed) {\r\n      if (!opts.subtotals) {\r\n        return keys;\r\n      }\r\n\r\n      const sortedKeys = keys.slice().sort((a, b) => {\r\n        const minLength = Math.min(a.length, b.length);\r\n        for (let i = 0; i < minLength; i++) {\r\n          const aStr = String(a[i]);\r\n          const bStr = String(b[i]);\r\n          const cmp = aStr.localeCompare(bStr);\r\n          if (cmp !== 0) {\r\n            return cmp;\r\n          }\r\n        }\r\n        return a.length - b.length;\r\n      });\r\n\r\n      const result = [];\r\n      const processedKeys = new Set();\r\n\r\n      for (const key of sortedKeys) {\r\n        let parentCollapsed = false;\r\n        let deepestCollapsedParent = null;\r\n\r\n        for (let i = 0; i < key.length; i++) {\r\n          const parentKey = key.slice(0, i + 1);\r\n          const flatParentKey = flatKey(parentKey);\r\n          if (collapsed[flatParentKey]) {\r\n            parentCollapsed = true;\r\n            deepestCollapsedParent = parentKey;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (parentCollapsed) {\r\n          const flatParentKey = flatKey(deepestCollapsedParent);\r\n          if (!processedKeys.has(flatParentKey)) {\r\n            result.push(deepestCollapsedParent);\r\n            processedKeys.add(flatParentKey);\r\n          }\r\n        } else {\r\n          const flatKey_ = flatKey(key);\r\n          if (!processedKeys.has(flatKey_)) {\r\n            result.push(key);\r\n            processedKeys.add(flatKey_);\r\n          }\r\n        }\r\n      }\r\n\r\n      const finalResult = [];\r\n      const addedSubtotals = new Set();\r\n\r\n      const parentGroups = new Map();\r\n      for (const key of result) {\r\n        for (let level = 1; level < key.length; level++) {\r\n          const parentKey = key.slice(0, level);\r\n          const parentKeyStr = flatKey(parentKey);\r\n\r\n          if (!parentGroups.has(parentKeyStr)) {\r\n            parentGroups.set(parentKeyStr, {\r\n              key: parentKey,\r\n              level: level,\r\n              lastChildIndex: -1,\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let i = 0; i < result.length; i++) {\r\n        const key = result[i];\r\n        for (let level = 1; level < key.length; level++) {\r\n          const parentKey = key.slice(0, level);\r\n          const parentKeyStr = flatKey(parentKey);\r\n          const parentGroup = parentGroups.get(parentKeyStr);\r\n\r\n          if (parentGroup) {\r\n            parentGroup.lastChildIndex = Math.max(\r\n              parentGroup.lastChildIndex,\r\n              i\r\n            );\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let i = 0; i < result.length; i++) {\r\n        const key = result[i];\r\n        finalResult.push(key);\r\n\r\n        const subtotalsToAdd = [];\r\n\r\n        for (let level = key.length - 1; level >= 1; level--) {\r\n          const parentKey = key.slice(0, level);\r\n          const parentKeyStr = flatKey(parentKey);\r\n          const parentGroup = parentGroups.get(parentKeyStr);\r\n\r\n          if (collapsed[parentKeyStr]) {\r\n            continue;\r\n          }\r\n\r\n          if (parentGroup && parentGroup.lastChildIndex === i) {\r\n            const subtotalKey = [...parentKey, '__subtotal__'];\r\n            const subtotalKeyStr = flatKey(subtotalKey);\r\n\r\n            if (!addedSubtotals.has(subtotalKeyStr)) {\r\n              subtotalsToAdd.push(subtotalKey);\r\n              addedSubtotals.add(subtotalKeyStr);\r\n            }\r\n          }\r\n        }\r\n\r\n        finalResult.push(...subtotalsToAdd);\r\n      }\r\n\r\n      return finalResult;\r\n    }\r\n\r\n    getSubtotal(rowKey, colKey, pivotSettings) {\r\n      const {pivotData} = pivotSettings;\r\n      return pivotData.getAggregator(rowKey, colKey).value();\r\n    }\r\n\r\n    hasSubtotals(rowOrCol, key, pivotSettings) {\r\n      const {rowAttrs, colAttrs} = pivotSettings;\r\n      const attrs = rowOrCol === 'row' ? rowAttrs : colAttrs;\r\n\r\n      return key.length < attrs.length;\r\n    }\r\n\r\n    safeGetAggregator(pivotData, rowKey, colKey) {\r\n      try {\r\n        return pivotData.getAggregator(rowKey, colKey);\r\n      } catch (error) {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    calculateSubtotal(pivotData, rowKey, colKey, pivotSettings) {\r\n      const {rowAttrs, colAttrs} = pivotSettings;\r\n\r\n      if (\r\n        rowKey.length === rowAttrs.length &&\r\n        colKey.length === colAttrs.length\r\n      ) {\r\n        const agg = this.safeGetAggregator(pivotData, rowKey, colKey);\r\n        return agg ? agg.value() : 0;\r\n      }\r\n\r\n      let total = 0;\r\n      let hasValidValues = false;\r\n\r\n      const childRowKeys = [];\r\n      if (rowKey.length < rowAttrs.length) {\r\n        pivotData.getRowKeys().forEach(fullRowKey => {\r\n          let isChild = true;\r\n          for (let i = 0; i < rowKey.length; i++) {\r\n            if (fullRowKey[i] !== rowKey[i]) {\r\n              isChild = false;\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (isChild) {\r\n            childRowKeys.push(fullRowKey);\r\n          }\r\n        });\r\n      } else {\r\n        childRowKeys.push(rowKey);\r\n      }\r\n\r\n      const childColKeys = [];\r\n      if (colKey.length < colAttrs.length) {\r\n        pivotData.getColKeys().forEach(fullColKey => {\r\n          let isChild = true;\r\n          for (let i = 0; i < colKey.length; i++) {\r\n            if (fullColKey[i] !== colKey[i]) {\r\n              isChild = false;\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (isChild) {\r\n            childColKeys.push(fullColKey);\r\n          }\r\n        });\r\n      } else {\r\n        childColKeys.push(colKey);\r\n      }\r\n\r\n      if (childRowKeys.length === 0 || childColKeys.length === 0) {\r\n        const agg = this.safeGetAggregator(pivotData, rowKey, colKey);\r\n        return agg ? agg.value() || 0 : 0;\r\n      }\r\n\r\n      childRowKeys.forEach(childRowKey => {\r\n        childColKeys.forEach(childColKey => {\r\n          const agg = this.safeGetAggregator(\r\n            pivotData,\r\n            childRowKey,\r\n            childColKey\r\n          );\r\n          if (agg) {\r\n            const val = agg.value();\r\n            if (val !== null && !isNaN(val)) {\r\n              total += val;\r\n              hasValidValues = true;\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n      return hasValidValues ? total : 0;\r\n    }\r\n\r\n    render() {\r\n      const pivotSettings = this.getBasePivotSettings();\r\n      const {colAttrs, rowAttrs, rowKeys, colKeys, rowTotals} = pivotSettings;\r\n\r\n      const renderedLabels = {};\r\n\r\n      const visibleRowKeys = opts.subtotals\r\n        ? this.visibleKeys(rowKeys, this.state.collapsedRows)\r\n        : rowKeys;\r\n      const visibleColKeys = opts.subtotals\r\n        ? this.visibleKeys(colKeys, this.state.collapsedCols)\r\n        : colKeys;\r\n\r\n      const finalPivotSettings = Object.assign(\r\n        {\r\n          visibleRowKeys,\r\n          maxRowVisible: Math.max(...visibleRowKeys.map(k => k.length)),\r\n          visibleColKeys,\r\n          maxColVisible: Math.max(...visibleColKeys.map(k => k.length)),\r\n          rowAttrSpans: this.calcAttrSpans(visibleRowKeys, rowAttrs.length),\r\n          colAttrSpans: this.calcAttrSpans(visibleColKeys, colAttrs.length),\r\n        },\r\n        pivotSettings\r\n      );\r\n\r\n      const rowspans = {};\r\n      visibleRowKeys.forEach((rowKey, rowIdx) => {\r\n        const isSubtotalRow = rowKey[rowKey.length - 1] === '__subtotal__';\r\n        const actualRowKey = isSubtotalRow ? rowKey.slice(0, -1) : rowKey;\r\n\r\n        for (let level = 0; level < actualRowKey.length; level++) {\r\n          const cellKey = `${rowIdx}-${level}`;\r\n\r\n          let span = 1;\r\n          let j = rowIdx + 1;\r\n          while (j < visibleRowKeys.length) {\r\n            const nextKey = visibleRowKeys[j];\r\n            const isNextSubtotal =\r\n              nextKey[nextKey.length - 1] === '__subtotal__';\r\n            const actualNextKey = isNextSubtotal\r\n              ? nextKey.slice(0, -1)\r\n              : nextKey;\r\n\r\n            if (level >= actualNextKey.length) {\r\n              break;\r\n            }\r\n\r\n            let matches = true;\r\n            for (let l = 0; l <= level; l++) {\r\n              if (\r\n                l >= actualNextKey.length ||\r\n                actualNextKey[l] !== actualRowKey[l]\r\n              ) {\r\n                matches = false;\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (!matches) {\r\n              break;\r\n            }\r\n            span++;\r\n            j++;\r\n          }\r\n\r\n          rowspans[cellKey] = span;\r\n        }\r\n      });\r\n\r\n      const renderedRows = visibleRowKeys.map((rowKey, i) => {\r\n        const rowCells = [];\r\n\r\n        const isSubtotalRow = rowKey[rowKey.length - 1] === '__subtotal__';\r\n        const actualRowKey = isSubtotalRow ? rowKey.slice(0, -1) : rowKey;\r\n\r\n        if (isSubtotalRow) {\r\n          rowCells.push(\r\n            <th\r\n              key=\"subtotalLabel\"\r\n              className=\"pvtRowLabel pvtSubtotal\"\r\n              colSpan={rowAttrs.length - actualRowKey.length + 1}\r\n            />\r\n          );\r\n        } else {\r\n          for (let level = 0; level < actualRowKey.length; level++) {\r\n            const labelKey = `${actualRowKey.slice(0, level + 1).join('|')}`;\r\n\r\n            if (!renderedLabels[labelKey]) {\r\n              renderedLabels[labelKey] = true;\r\n\r\n              const cellKey = `${i}-${level}`;\r\n              const rowspan = rowspans[cellKey] || 1;\r\n\r\n              const flatRowKey = flatKey(actualRowKey.slice(0, level + 1));\r\n              const isCollapsed = this.state.collapsedRows[flatRowKey];\r\n\r\n              let className = 'pvtRowLabel';\r\n\r\n              let icon = null;\r\n\r\n              if (level + 1 < rowAttrs.length) {\r\n                if (isCollapsed) {\r\n                  className += ' collapsed';\r\n                  icon = pivotSettings.arrowCollapsed;\r\n                } else {\r\n                  className += ' expanded';\r\n                  icon = pivotSettings.arrowExpanded;\r\n                }\r\n                rowCells.push(\r\n                  <th\r\n                    key={`rowLabel-${level}`}\r\n                    className={className}\r\n                    rowSpan={rowspan}\r\n                    onClick={this.toggleRowKey(flatRowKey)}\r\n                    style={{cursor: 'pointer'}}\r\n                  >\r\n                    {icon && (\r\n                      <span className=\"pvtAttr\" style={{marginRight: '6px'}}>\r\n                        {icon}\r\n                      </span>\r\n                    )}\r\n                    <span>{actualRowKey[level]}</span>\r\n                  </th>\r\n                );\r\n                continue;\r\n              }\r\n\r\n              const isLeafLevel =\r\n                level === actualRowKey.length - 1 &&\r\n                actualRowKey.length === rowAttrs.length;\r\n              const leafColspan = isLeafLevel ? 2 : 1;\r\n\r\n              rowCells.push(\r\n                <th\r\n                  key={`rowLabel-${level}`}\r\n                  className={className}\r\n                  rowSpan={rowspan}\r\n                  colSpan={leafColspan}\r\n                  onClick={this.toggleRowKey(flatRowKey)}\r\n                >\r\n                  {icon && <span className=\"pvtAttr\">{icon}</span>}\r\n                  <span>{actualRowKey[level]}</span>\r\n                </th>\r\n              );\r\n            }\r\n          }\r\n\r\n          if (actualRowKey.length < rowAttrs.length) {\r\n            rowCells.push(\r\n              <th\r\n                key=\"padding\"\r\n                className=\"pvtRowLabel\"\r\n                colSpan={rowAttrs.length - actualRowKey.length + 1}\r\n              />\r\n            );\r\n          }\r\n        }\r\n\r\n        const dataCells = this.renderTableRow(rowKey, i, finalPivotSettings);\r\n\r\n        return (\r\n          <tr\r\n            key={`row-${i}`}\r\n            className={isSubtotalRow && opts.subtotals ? 'pvtSubtotalRow' : ''}\r\n          >\r\n            {rowCells}\r\n            {dataCells}\r\n          </tr>\r\n        );\r\n      });\r\n\r\n      const colAttrsHeaders = colAttrs.map((attrName, i) => {\r\n        return (\r\n          <tr key={`colAttr-${i}`}>\r\n            {this.renderColHeaderRow(attrName, i, finalPivotSettings)}\r\n          </tr>\r\n        );\r\n      });\r\n\r\n      let rowAttrsHeader = null;\r\n      if (rowAttrs.length > 0) {\r\n        rowAttrsHeader = (\r\n          <tr key=\"rowAttr-0\">{this.renderRowHeaderRow(finalPivotSettings)}</tr>\r\n        );\r\n      }\r\n\r\n      let totalHeader = null;\r\n      if (rowTotals) {\r\n        totalHeader = (\r\n          <tr key=\"total\">{this.renderTotalsRow(finalPivotSettings)}</tr>\r\n        );\r\n      }\r\n\r\n      return (\r\n        <table className=\"pvtTable\">\r\n          <thead>\r\n            {colAttrsHeaders}\r\n            {rowAttrsHeader}\r\n          </thead>\r\n          <tbody>\r\n            {renderedRows}\r\n            {totalHeader}\r\n          </tbody>\r\n        </table>\r\n      );\r\n    }\r\n  }\r\n\r\n  SubtotalRenderer.defaultProps = Object.assign({}, PivotData.defaultProps, {\r\n    tableColorScaleGenerator: redColorScaleGenerator,\r\n    tableOptions: {},\r\n  });\r\n  SubtotalRenderer.propTypes = Object.assign({}, PivotData.propTypes, {\r\n    tableColorScaleGenerator: PropTypes.func,\r\n    tableOptions: PropTypes.object,\r\n  });\r\n  return SubtotalRenderer;\r\n}\r\n\r\nclass TSVExportRenderer extends React.PureComponent {\r\n  render() {\r\n    const pivotData = new PivotData(this.props);\r\n    const rowKeys = pivotData.getRowKeys();\r\n    const colKeys = pivotData.getColKeys();\r\n    if (rowKeys.length === 0) {\r\n      rowKeys.push([]);\r\n    }\r\n    if (colKeys.length === 0) {\r\n      colKeys.push([]);\r\n    }\r\n\r\n    const headerRow = pivotData.props.rows.map(r => r);\r\n    if (colKeys.length === 1 && colKeys[0].length === 0) {\r\n      headerRow.push(this.props.aggregatorName);\r\n    } else {\r\n      colKeys.map(c => headerRow.push(c.join('-')));\r\n    }\r\n\r\n    const result = rowKeys.map(r => {\r\n      const row = r.map(x => x);\r\n      colKeys.map(c => {\r\n        const aggregator = pivotData.getAggregator(r, c);\r\n        row.push(aggregator.value());\r\n      });\r\n      return row;\r\n    });\r\n\r\n    result.unshift(headerRow);\r\n\r\n    return (\r\n      <textarea\r\n        value={result.map(r => r.join('\\t')).join('\\n')}\r\n        style={{width: window.innerWidth / 2, height: window.innerHeight / 2}}\r\n        readOnly={true}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nTSVExportRenderer.defaultProps = PivotData.defaultProps;\r\nTSVExportRenderer.propTypes = PivotData.propTypes;\r\n\r\nexport default {\r\n  'Table With Subtotal': makeRenderer({subtotals: true}),\r\n  'Heatmap With Subtotal': makeRenderer({\r\n    heatmapMode: 'full',\r\n    subtotals: true,\r\n  }),\r\n  'Col Heatmap With Subtotal': makeRenderer({\r\n    heatmapMode: 'col',\r\n    subtotals: true,\r\n  }),\r\n  'Row Heatmap With Subtotal': makeRenderer({\r\n    heatmapMode: 'row',\r\n    subtotals: true,\r\n  }),\r\n  'Exportable TSV': TSVExportRenderer,\r\n};\r\n"],"mappings":"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","ignoreList":[]}