{"version":3,"sources":["src/SubtotalRenderers.jsx"],"names":["redColorScaleGenerator","values","min","Math","apply","max","nonRed","round","x","backgroundColor","makeRenderer","opts","SubtotalRenderer","props","state","collapsedRows","collapsedCols","subtotals","document","getElementById","style","createElement","id","innerHTML","head","appendChild","colAttrs","cols","rowAttrs","rows","tableOptions","Object","assign","rowTotals","colTotals","length","subtotalOptions","arrowCollapsed","arrowExpanded","colSubtotalDisplay","displayOnTop","enabled","hideOnExpand","rowSubtotalDisplay","pivotData","PivotData","rowEnabled","colEnabled","rowPartialOnTop","colPartialOnTop","rowKeys","getRowKeys","colKeys","getColKeys","cellCallbacks","rowTotalCallbacks","colTotalCallbacks","grandTotalCallback","clickCallback","forEach","flatRowKey","rowKey","flatColKey","colKey","clickHandler","heatmapMappers","tableColorScaleGenerator","rowValues","colValues","value","getAggregator","filters","colLimit","i","attr","rowLimit","e","rowOrCol","attrIdx","allKeys","flatCollapseKeys","k","slicedKey","slice","setState","prevState","bind","newCollapsedRows","newCollapsedCols","attrArr","numAttrs","spans","li","Array","map","lv","cv","isSubtotal","actualCv","ent","depth","limit","push","attrName","pivotSettings","visibleColKeys","colAttrSpans","spaceCell","needToggle","attrNameCell","attrValueCells","rowIncrSpan","isSubtotalCol","actualColKey","colSpan","rowSpan","onClick","toggleColKey","headerText","headerClass","isCollapsedParent","cursor","totalCell","cells","r","rowIdx","rowMapper","colMapper","visibleKeys","isSubtotalRow","actualRowKey","aggregator","className","valCss","needsSubtotalValue","calculateSubtotal","tempAggregator","safeGetAggregator","format","heatmapMode","bgColorFromSubtotalValue","cellColor","bgColorFromRowColKey","val","formattedVal","cellKey","colCellKey","error","totalVal","formattedTotal","agg","isNaN","totalColor","formatFunc","includes","colTotal","displayValue","grandTotal","validValuesFound","grandTotalAggregator","grandTotalColor","keys","collapsed","sortedKeys","sort","a","b","minLength","aStr","String","bStr","cmp","localeCompare","result","processedKeys","Set","key","parentCollapsed","deepestCollapsedParent","parentKey","flatParentKey","has","add","flatKey_","finalResult","addedSubtotals","parentGroups","Map","level","parentKeyStr","set","lastChildIndex","parentGroup","get","subtotalsToAdd","subtotalKey","subtotalKeyStr","attrs","total","hasValidValues","childRowKeys","isChild","fullRowKey","childColKeys","fullColKey","childRowKey","childColKey","getBasePivotSettings","renderedLabels","visibleRowKeys","finalPivotSettings","maxRowVisible","maxColVisible","rowAttrSpans","calcAttrSpans","rowspans","span","j","nextKey","isNextSubtotal","actualNextKey","matches","l","renderedRows","rowCells","labelKey","join","rowspan","isCollapsed","icon","toggleRowKey","marginRight","isLeafLevel","leafColspan","dataCells","renderTableRow","colAttrsHeaders","renderColHeaderRow","rowAttrsHeader","renderRowHeaderRow","totalHeader","renderTotalsRow","colorScaleGenerator","valueCellColors","rowTotalColors","colTotalColors","allValues","forEachCell","flatRow","flatCol","rowTotal","rowTotalValues","forEachTotal","valKey","_x","rowTotalColorScale","colTotalValues","colTotalColorScale","grandTotalVal","grandTotalColorScale","colorScale","rowColorScales","entries","colColorScales","React","Component","defaultProps","propTypes","PropTypes","func","object","TSVExportRenderer","headerRow","aggregatorName","c","row","unshift","width","window","innerWidth","height","innerHeight","PureComponent"],"mappings":"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","file":"SubtotalRenderers.js","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {PivotData, flatKey} from './Utilities';\r\n\r\nfunction redColorScaleGenerator(values) {\r\n  const min = Math.min.apply(Math, values);\r\n  const max = Math.max.apply(Math, values);\r\n  return x => {\r\n    // eslint-disable-next-line no-magic-numbers\r\n    const nonRed = 255 - Math.round((255 * (x - min)) / (max - min));\r\n    return {backgroundColor: `rgb(255,${nonRed},${nonRed})`};\r\n  };\r\n}\r\n\r\nfunction makeRenderer(opts = {}) {\r\n  class SubtotalRenderer extends React.Component {\r\n    constructor(props) {\r\n      super(props);\r\n      this.state = {collapsedRows: {}, collapsedCols: {}};\r\n    }\r\n\r\n    componentDidMount() {\r\n      if (\r\n        opts.subtotals &&\r\n        !document.getElementById('react-pivottable-subtotal-styles')\r\n      ) {\r\n        const style = document.createElement('style');\r\n        style.id = 'react-pivottable-subtotal-styles';\r\n        style.innerHTML = `\r\n          .pvtSubtotal {\r\n            font-weight: bold;\r\n            background-color: #f0f0f0;\r\n          }\r\n          .pvtSubtotalRow {\r\n            border-top: 1px solid #ddd;\r\n          }\r\n          .pvtSubtotalVal {\r\n            color: #777;\r\n            font-style: italic;\r\n          }\r\n        `;\r\n        document.head.appendChild(style);\r\n      }\r\n    }\r\n\r\n    getBasePivotSettings() {\r\n      const props = this.props;\r\n      const colAttrs = props.cols;\r\n      const rowAttrs = props.rows;\r\n\r\n      const tableOptions = Object.assign(\r\n        {\r\n          rowTotals: true,\r\n          colTotals: true,\r\n        },\r\n        props.tableOptions\r\n      );\r\n      const rowTotals = tableOptions.rowTotals || colAttrs.length === 0;\r\n      const colTotals = tableOptions.colTotals || rowAttrs.length === 0;\r\n\r\n      const subtotalOptions = Object.assign(\r\n        {\r\n          arrowCollapsed: '\\u25B6',\r\n          arrowExpanded: '\\u25E2',\r\n        },\r\n        props.subtotalOptions\r\n      );\r\n\r\n      const colSubtotalDisplay = Object.assign(\r\n        {\r\n          displayOnTop: false,\r\n          enabled: rowTotals,\r\n          hideOnExpand: false,\r\n        },\r\n        subtotalOptions.colSubtotalDisplay\r\n      );\r\n\r\n      const rowSubtotalDisplay = Object.assign(\r\n        {\r\n          displayOnTop: true,\r\n          enabled: colTotals,\r\n          hideOnExpand: false,\r\n        },\r\n        subtotalOptions.rowSubtotalDisplay\r\n      );\r\n\r\n      const pivotData = new PivotData(\r\n        props,\r\n        !opts.subtotals\r\n          ? {}\r\n          : {\r\n              rowEnabled: rowSubtotalDisplay.enabled,\r\n              colEnabled: colSubtotalDisplay.enabled,\r\n              rowPartialOnTop: rowSubtotalDisplay.displayOnTop,\r\n              colPartialOnTop: colSubtotalDisplay.displayOnTop,\r\n            }\r\n      );\r\n      const rowKeys = pivotData.getRowKeys();\r\n      const colKeys = pivotData.getColKeys();\r\n\r\n      const cellCallbacks = {};\r\n      const rowTotalCallbacks = {};\r\n      const colTotalCallbacks = {};\r\n      let grandTotalCallback = null;\r\n      if (tableOptions.clickCallback) {\r\n        rowKeys.forEach(rowKey => {\r\n          const flatRowKey = flatKey(rowKey);\r\n          cellCallbacks[flatRowKey] = {};\r\n          colKeys.forEach(colKey => {\r\n            const flatColKey = flatKey(colKey);\r\n            if (!(flatRowKey in cellCallbacks)) {\r\n              cellCallbacks[flatRowKey] = {};\r\n            }\r\n            cellCallbacks[flatRowKey][flatColKey] = this.clickHandler(\r\n              pivotData,\r\n              rowKey,\r\n              colKey\r\n            );\r\n          });\r\n          rowTotalCallbacks[flatRowKey] = this.clickHandler(\r\n            pivotData,\r\n            rowKey,\r\n            []\r\n          );\r\n        });\r\n        colKeys.forEach(colKey => {\r\n          const flatColKey = flatKey(colKey);\r\n          colTotalCallbacks[flatColKey] = this.clickHandler(\r\n            pivotData,\r\n            [],\r\n            colKey\r\n          );\r\n        });\r\n        grandTotalCallback = this.clickHandler(pivotData, [], []);\r\n      }\r\n\r\n      return Object.assign(\r\n        {\r\n          pivotData,\r\n          colAttrs,\r\n          rowAttrs,\r\n          colKeys,\r\n          rowKeys,\r\n          rowTotals,\r\n          colTotals,\r\n          arrowCollapsed: subtotalOptions.arrowCollapsed,\r\n          arrowExpanded: subtotalOptions.arrowExpanded,\r\n          colSubtotalDisplay,\r\n          rowSubtotalDisplay,\r\n          cellCallbacks,\r\n          rowTotalCallbacks,\r\n          colTotalCallbacks,\r\n          grandTotalCallback,\r\n        },\r\n        SubtotalRenderer.heatmapMappers(\r\n          pivotData,\r\n          props.tableColorScaleGenerator,\r\n          colTotals,\r\n          rowTotals\r\n        )\r\n      );\r\n    }\r\n\r\n    clickHandler(pivotData, rowValues, colValues) {\r\n      const colAttrs = this.props.cols;\r\n      const rowAttrs = this.props.rows;\r\n      const value = pivotData.getAggregator(rowValues, colValues).value();\r\n      const filters = {};\r\n      const colLimit = Math.min(colAttrs.length, colValues.length);\r\n      for (let i = 0; i < colLimit; i++) {\r\n        const attr = colAttrs[i];\r\n        if (colValues[i] !== null) {\r\n          filters[attr] = colValues[i];\r\n        }\r\n      }\r\n      const rowLimit = Math.min(rowAttrs.length, rowValues.length);\r\n      for (let i = 0; i < rowLimit; i++) {\r\n        const attr = rowAttrs[i];\r\n        if (rowValues[i] !== null) {\r\n          filters[attr] = rowValues[i];\r\n        }\r\n      }\r\n      return e =>\r\n        this.props.tableOptions.clickCallback(e, value, filters, pivotData);\r\n    }\r\n\r\n    collapseAttr(rowOrCol, attrIdx, allKeys) {\r\n      return function() {\r\n        var flatCollapseKeys = {};\r\n        for (var i = 0; i < allKeys.length; i++) {\r\n          var k = allKeys[i];\r\n          var slicedKey = k.slice(0, attrIdx + 1);\r\n          flatCollapseKeys[flatKey(slicedKey)] = true;\r\n        }\r\n        this.setState(function(prevState) {\r\n          if (rowOrCol === 'row') {\r\n            return {\r\n              collapsedRows: Object.assign(\r\n                {},\r\n                prevState.collapsedRows,\r\n                flatCollapseKeys\r\n              ),\r\n            };\r\n          } else if (rowOrCol === 'col') {\r\n            return {\r\n              collapsedCols: Object.assign(\r\n                {},\r\n                prevState.collapsedCols,\r\n                flatCollapseKeys\r\n              ),\r\n            };\r\n          }\r\n          return null;\r\n        });\r\n      }.bind(this);\r\n    }\r\n\r\n    expandAttr(rowOrCol, attrIdx, allKeys) {\r\n      return function() {\r\n        var flatCollapseKeys = {};\r\n        for (var i = 0; i < allKeys.length; i++) {\r\n          var k = allKeys[i];\r\n          var slicedKey = k.slice(0, attrIdx + 1);\r\n          flatCollapseKeys[flatKey(slicedKey)] = false;\r\n        }\r\n        this.setState(function(prevState) {\r\n          if (rowOrCol === 'row') {\r\n            return {\r\n              collapsedRows: Object.assign(\r\n                {},\r\n                prevState.collapsedRows,\r\n                flatCollapseKeys\r\n              ),\r\n            };\r\n          } else if (rowOrCol === 'col') {\r\n            return {\r\n              collapsedCols: Object.assign(\r\n                {},\r\n                prevState.collapsedCols,\r\n                flatCollapseKeys\r\n              ),\r\n            };\r\n          }\r\n          return null;\r\n        });\r\n      }.bind(this);\r\n    }\r\n\r\n    toggleRowKey(flatRowKey) {\r\n      return function() {\r\n        this.setState(function(prevState) {\r\n          var newCollapsedRows = Object.assign({}, prevState.collapsedRows);\r\n          newCollapsedRows[flatRowKey] = !prevState.collapsedRows[flatRowKey];\r\n          return {collapsedRows: newCollapsedRows};\r\n        });\r\n      }.bind(this);\r\n    }\r\n\r\n    toggleColKey(flatColKey) {\r\n      return function() {\r\n        this.setState(function(prevState) {\r\n          var newCollapsedCols = Object.assign({}, prevState.collapsedCols);\r\n          newCollapsedCols[flatColKey] = !prevState.collapsedCols[flatColKey];\r\n          return {collapsedCols: newCollapsedCols};\r\n        });\r\n      }.bind(this);\r\n    }\r\n\r\n    // Given an array of attribute values (i.e. each element is another array with\r\n    // the value at every level), compute the spans for every attribute value at\r\n    // each level.\r\n    calcAttrSpans(attrArr, numAttrs) {\r\n      const spans = [];\r\n      const li = Array(numAttrs).map(() => 0);\r\n      let lv = Array(numAttrs).map(() => null);\r\n      for (let i = 0; i < attrArr.length; i++) {\r\n        const cv = attrArr[i];\r\n        const isSubtotal = cv[cv.length - 1] === '__subtotal__';\r\n        const actualCv = isSubtotal ? cv.slice(0, -1) : cv;\r\n\r\n        const ent = [];\r\n        let depth = 0;\r\n        const limit = Math.min(lv.length, actualCv.length);\r\n        while (depth < limit && lv[depth] === actualCv[depth]) {\r\n          ent.push(-1);\r\n          spans[li[depth]][depth]++;\r\n          depth++;\r\n        }\r\n        while (depth < actualCv.length) {\r\n          li[depth] = i;\r\n          ent.push(1);\r\n          depth++;\r\n        }\r\n        spans.push(ent);\r\n        lv = actualCv;\r\n      }\r\n      return spans;\r\n    }\r\n\r\n    static heatmapMappers(\r\n      pivotData,\r\n      colorScaleGenerator,\r\n      colTotals,\r\n      rowTotals\r\n    ) {\r\n      const colMapper = {};\r\n      const rowMapper = {};\r\n\r\n      if (colorScaleGenerator && opts.heatmapMode) {\r\n        const valueCellColors = {};\r\n        const rowTotalColors = {};\r\n        const colTotalColors = {};\r\n        let grandTotalColor = null;\r\n\r\n        const allValues = [];\r\n        const rowValues = {};\r\n        const colValues = {};\r\n\r\n        pivotData.forEachCell((val, rowKey, colKey) => {\r\n          if (val !== null && !isNaN(val)) {\r\n            allValues.push(val);\r\n\r\n            const flatRow = flatKey(rowKey);\r\n            if (!rowValues[flatRow]) {\r\n              rowValues[flatRow] = [];\r\n            }\r\n            rowValues[flatRow].push(val);\r\n\r\n            const flatCol = flatKey(colKey);\r\n            if (!colValues[flatCol]) {\r\n              colValues[flatCol] = [];\r\n            }\r\n            colValues[flatCol].push(val);\r\n          }\r\n        });\r\n\r\n        if (opts.heatmapMode === 'row' && colTotals) {\r\n          pivotData.getRowKeys().forEach(rowKey => {\r\n            let rowTotal = 0;\r\n            let hasValidValues = false;\r\n            pivotData.getColKeys().forEach(colKey => {\r\n              const agg = pivotData.getAggregator(rowKey, colKey);\r\n              if (agg) {\r\n                const val = agg.value();\r\n                if (val !== null && !isNaN(val)) {\r\n                  rowTotal += val;\r\n                  hasValidValues = true;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (hasValidValues && rowTotal !== 0) {\r\n              const flatRow = flatKey(rowKey);\r\n              if (!rowValues[flatRow]) {\r\n                rowValues[flatRow] = [];\r\n              }\r\n              rowValues[flatRow].push(rowTotal);\r\n            }\r\n          });\r\n        }\r\n\r\n        if (opts.heatmapMode === 'col' && rowTotals) {\r\n          pivotData.getColKeys().forEach(colKey => {\r\n            let colTotal = 0;\r\n            let hasValidValues = false;\r\n            pivotData.getRowKeys().forEach(rowKey => {\r\n              const agg = pivotData.getAggregator(rowKey, colKey);\r\n              if (agg) {\r\n                const val = agg.value();\r\n                if (val !== null && !isNaN(val)) {\r\n                  colTotal += val;\r\n                  hasValidValues = true;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (hasValidValues && colTotal !== 0) {\r\n              const flatCol = flatKey(colKey);\r\n              if (!colValues[flatCol]) {\r\n                colValues[flatCol] = [];\r\n              }\r\n              colValues[flatCol].push(colTotal);\r\n            }\r\n          });\r\n        }\r\n\r\n        if (colTotals) {\r\n          const rowTotalValues = [];\r\n          pivotData.forEachTotal(([valKey, _x]) => {\r\n            const val = pivotData.getAggregator([valKey], []).value();\r\n            if (val !== null && !isNaN(val)) {\r\n              rowTotalValues.push(val);\r\n              if (opts.heatmapMode === 'full') {\r\n                allValues.push(val);\r\n              }\r\n            }\r\n          });\r\n\r\n          const rowTotalColorScale =\r\n            opts.heatmapMode === 'full'\r\n              ? colorScaleGenerator(allValues)\r\n              : colorScaleGenerator(rowTotalValues);\r\n\r\n          pivotData.forEachTotal(([valKey, _x]) => {\r\n            const val = pivotData.getAggregator([valKey], []).value();\r\n            if (val !== null && !isNaN(val)) {\r\n              rowTotalColors[flatKey([valKey])] = rowTotalColorScale(val);\r\n            }\r\n          });\r\n        }\r\n\r\n        if (rowTotals) {\r\n          const colTotalValues = [];\r\n          pivotData.forEachTotal(([_x, valKey]) => {\r\n            const val = pivotData.getAggregator([], [valKey]).value();\r\n            if (val !== null && !isNaN(val)) {\r\n              colTotalValues.push(val);\r\n              if (opts.heatmapMode === 'full') {\r\n                allValues.push(val);\r\n              }\r\n            }\r\n          });\r\n\r\n          const colTotalColorScale =\r\n            opts.heatmapMode === 'full'\r\n              ? colorScaleGenerator(allValues)\r\n              : colorScaleGenerator(colTotalValues);\r\n\r\n          pivotData.forEachTotal(([_x, valKey]) => {\r\n            const val = pivotData.getAggregator([], [valKey]).value();\r\n            if (val !== null && !isNaN(val)) {\r\n              colTotalColors[flatKey([valKey])] = colTotalColorScale(val);\r\n            }\r\n          });\r\n        }\r\n\r\n        if (colTotals && rowTotals) {\r\n          const grandTotalVal = pivotData.getAggregator([], []).value();\r\n          if (grandTotalVal !== null && !isNaN(grandTotalVal)) {\r\n            if (opts.heatmapMode === 'full') {\r\n              allValues.push(grandTotalVal);\r\n              const grandTotalColorScale = colorScaleGenerator(allValues);\r\n              grandTotalColor = grandTotalColorScale(grandTotalVal);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (rowTotals) {\r\n          colMapper.totalColor = key => colTotalColors[flatKey([key])];\r\n        }\r\n        if (colTotals) {\r\n          rowMapper.totalColor = key => rowTotalColors[flatKey([key])];\r\n        }\r\n        if (grandTotalColor) {\r\n          colMapper.grandTotalColor = grandTotalColor;\r\n        }\r\n\r\n        if (opts.heatmapMode === 'full') {\r\n          // Full heatmap: Compare values across the entire table\r\n          // Note: allValues already contains all cell values from earlier collection\r\n          const colorScale = colorScaleGenerator(allValues);\r\n          pivotData.forEachCell((val, rowKey, colKey) => {\r\n            if (val !== null && !isNaN(val)) {\r\n              valueCellColors[\r\n                `${flatKey(rowKey)}_${flatKey(colKey)}`\r\n              ] = colorScale(val);\r\n            }\r\n          });\r\n\r\n          colMapper.bgColorFromRowColKey = (rowKey, colKey) =>\r\n            valueCellColors[`${flatKey(rowKey)}_${flatKey(colKey)}`];\r\n\r\n          colMapper.bgColorFromSubtotalValue = value => {\r\n            if (value !== null && !isNaN(value)) {\r\n              return colorScale(value);\r\n            }\r\n            return null;\r\n          };\r\n        } else if (opts.heatmapMode === 'row') {\r\n          // Row heatmap: Compare values within each row\r\n          // Note: rowValues already populated from earlier collection\r\n          const rowColorScales = {};\r\n          Object.entries(rowValues).forEach(([flatRow, values]) => {\r\n            if (values.length > 0) {\r\n              rowColorScales[flatRow] = colorScaleGenerator(values);\r\n            }\r\n          });\r\n\r\n          pivotData.forEachCell((val, rowKey, colKey) => {\r\n            const flatRow = flatKey(rowKey);\r\n            if (val !== null && !isNaN(val) && rowColorScales[flatRow]) {\r\n              valueCellColors[`${flatRow}_${flatKey(colKey)}`] = rowColorScales[\r\n                flatRow\r\n              ](val);\r\n            }\r\n          });\r\n\r\n          colMapper.bgColorFromRowColKey = (rowKey, colKey) =>\r\n            valueCellColors[`${flatKey(rowKey)}_${flatKey(colKey)}`];\r\n\r\n          colMapper.bgColorFromSubtotalValue = (value, rowKey) => {\r\n            if (value !== null && !isNaN(value)) {\r\n              const flatRow = flatKey(rowKey);\r\n              if (rowColorScales[flatRow]) {\r\n                return rowColorScales[flatRow](value);\r\n              }\r\n            }\r\n            return null;\r\n          };\r\n        } else if (opts.heatmapMode === 'col') {\r\n          // Column heatmap: Compare values within each column\r\n          // Note: colValues already populated from earlier collection\r\n          const colColorScales = {};\r\n          Object.entries(colValues).forEach(([flatCol, values]) => {\r\n            if (values.length > 0) {\r\n              colColorScales[flatCol] = colorScaleGenerator(values);\r\n            }\r\n          });\r\n\r\n          pivotData.forEachCell((val, rowKey, colKey) => {\r\n            const flatCol = flatKey(colKey);\r\n            if (val !== null && !isNaN(val) && colColorScales[flatCol]) {\r\n              valueCellColors[`${flatKey(rowKey)}_${flatCol}`] = colColorScales[\r\n                flatCol\r\n              ](val);\r\n            }\r\n          });\r\n\r\n          colMapper.bgColorFromRowColKey = (rowKey, colKey) =>\r\n            valueCellColors[`${flatKey(rowKey)}_${flatKey(colKey)}`];\r\n\r\n          colMapper.bgColorFromSubtotalValue = (value, rowKey, colKey) => {\r\n            if (value !== null && !isNaN(value)) {\r\n              const flatCol = flatKey(colKey);\r\n              if (colColorScales[flatCol]) {\r\n                return colColorScales[flatCol](value);\r\n              }\r\n            }\r\n            return null;\r\n          };\r\n        }\r\n      }\r\n      return {colMapper, rowMapper};\r\n    }\r\n\r\n    renderColHeaderRow(attrName, attrIdx, pivotSettings) {\r\n      const {\r\n        rowAttrs,\r\n        colAttrs,\r\n        visibleColKeys,\r\n        colAttrSpans,\r\n        rowTotals,\r\n        arrowExpanded,\r\n        arrowCollapsed,\r\n        colSubtotalDisplay,\r\n      } = pivotSettings;\r\n\r\n      const spaceCell =\r\n        attrIdx === 0 && rowAttrs.length !== 0 ? (\r\n          <th\r\n            key=\"padding\"\r\n            colSpan={rowAttrs.length}\r\n            rowSpan={colAttrs.length}\r\n          />\r\n        ) : null;\r\n\r\n      const needToggle =\r\n        opts.subtotals &&\r\n        colSubtotalDisplay.enabled &&\r\n        attrIdx !== colAttrs.length - 1;\r\n      const attrNameCell = (\r\n        <th key=\"label\" className=\"pvtAxisLabel\">\r\n          {attrName}\r\n        </th>\r\n      );\r\n\r\n      const attrValueCells = [];\r\n      const rowIncrSpan = rowAttrs.length !== 0 ? 1 : 0;\r\n      let i = 0;\r\n      while (i < visibleColKeys.length) {\r\n        const colKey = visibleColKeys[i];\r\n        const isSubtotalCol = colKey[colKey.length - 1] === '__subtotal__';\r\n        const actualColKey = isSubtotalCol ? colKey.slice(0, -1) : colKey;\r\n\r\n        const colSpan =\r\n          attrIdx < actualColKey.length ? colAttrSpans[i][attrIdx] : 1;\r\n        if (attrIdx < actualColKey.length) {\r\n          const rowSpan =\r\n            1 + (attrIdx === colAttrs.length - 1 ? rowIncrSpan : 0);\r\n          const flatColKey = flatKey(actualColKey.slice(0, attrIdx + 1));\r\n          const onClick = needToggle ? this.toggleColKey(flatColKey) : null;\r\n\r\n          let headerText = actualColKey[attrIdx];\r\n          let headerClass = 'pvtColLabel';\r\n\r\n          const isCollapsedParent =\r\n            this.state.collapsedCols[flatColKey] &&\r\n            actualColKey.length < colAttrs.length;\r\n\r\n          if (isSubtotalCol) {\r\n            headerText = `${headerText} (Subtotal)`;\r\n            headerClass += ' pvtSubtotal';\r\n          } else if (isCollapsedParent) {\r\n            headerClass += ' pvtSubtotal';\r\n          }\r\n\r\n          attrValueCells.push(\r\n            <th\r\n              className={headerClass}\r\n              key={'colKey-' + flatColKey + (isSubtotalCol ? '-subtotal' : '')}\r\n              colSpan={colSpan}\r\n              rowSpan={rowSpan}\r\n              onClick={onClick}\r\n              style={{cursor: needToggle ? 'pointer' : 'default'}}\r\n            >\r\n              {needToggle\r\n                ? (this.state.collapsedCols[flatColKey]\r\n                    ? arrowCollapsed\r\n                    : arrowExpanded) + ' '\r\n                : null}\r\n              {headerText}\r\n            </th>\r\n          );\r\n        } else if (attrIdx === actualColKey.length) {\r\n          const rowSpan = colAttrs.length - actualColKey.length + rowIncrSpan;\r\n          const flatColKey = flatKey(actualColKey);\r\n          const isCollapsedParent =\r\n            this.state.collapsedCols[flatColKey] &&\r\n            actualColKey.length < colAttrs.length;\r\n\r\n          attrValueCells.push(\r\n            <th\r\n              className={`pvtColLabel ${\r\n                isSubtotalCol || isCollapsedParent ? 'pvtSubtotal' : ''\r\n              }`}\r\n              key={\r\n                'colKeyBuffer-' +\r\n                flatKey(actualColKey) +\r\n                (isSubtotalCol ? '-subtotal' : '')\r\n              }\r\n              colSpan={colSpan}\r\n              rowSpan={rowSpan}\r\n            />\r\n          );\r\n        }\r\n        i = i + colSpan;\r\n      }\r\n\r\n      const totalCell =\r\n        attrIdx === 0 && rowTotals ? (\r\n          <th\r\n            key=\"total\"\r\n            className=\"pvtTotalLabel\"\r\n            rowSpan={colAttrs.length + Math.min(rowAttrs.length, 1)}\r\n          >\r\n            Totals\r\n          </th>\r\n        ) : null;\r\n\r\n      const cells = [spaceCell, attrNameCell, ...attrValueCells, totalCell];\r\n      return cells;\r\n    }\r\n\r\n    renderRowHeaderRow(pivotSettings) {\r\n      const {colAttrs, rowAttrs} = pivotSettings;\r\n      const cells = [];\r\n      if (rowAttrs.length !== 0) {\r\n        rowAttrs.map(function(r, i) {\r\n          cells.push(\r\n            <th className=\"pvtAxisLabel\" key={`rowAttr${i}`}>\r\n              {r}\r\n            </th>\r\n          );\r\n        });\r\n        cells.push(\r\n          <th className=\"pvtTotalLabel\" key=\"total\">\r\n            {colAttrs.length === 0 ? 'Totals' : null}\r\n          </th>\r\n        );\r\n      }\r\n      return cells;\r\n    }\r\n\r\n    renderTableRow(rowKey, rowIdx, pivotSettings) {\r\n      const {\r\n        colKeys,\r\n        rowAttrs,\r\n        colAttrs,\r\n        rowTotals,\r\n        pivotData,\r\n        rowMapper,\r\n        colMapper,\r\n        cellCallbacks,\r\n        rowTotalCallbacks,\r\n      } = pivotSettings;\r\n\r\n      const visibleColKeys = this.visibleKeys(\r\n        colKeys,\r\n        this.state.collapsedCols\r\n      );\r\n\r\n      const cells = [];\r\n      const isSubtotalRow = rowKey[rowKey.length - 1] === '__subtotal__';\r\n      const actualRowKey = isSubtotalRow ? rowKey.slice(0, -1) : rowKey;\r\n\r\n      visibleColKeys.forEach((colKey, i) => {\r\n        try {\r\n          if (!actualRowKey || !colKey) {\r\n            cells.push(<td className=\"pvtVal\" key={`pvtVal-${i}`} />);\r\n            return;\r\n          }\r\n\r\n          let aggregator,\r\n            className,\r\n            valCss = {};\r\n\r\n          const isSubtotalCol = colKey[colKey.length - 1] === '__subtotal__';\r\n          const actualColKey = isSubtotalCol ? colKey.slice(0, -1) : colKey;\r\n\r\n          const needsSubtotalValue =\r\n            isSubtotalRow ||\r\n            isSubtotalCol ||\r\n            (actualColKey.length < colAttrs.length &&\r\n              this.state.collapsedCols[flatKey(actualColKey)]) ||\r\n            (actualRowKey.length < rowAttrs.length &&\r\n              this.state.collapsedRows[flatKey(actualRowKey)]);\r\n\r\n          if (needsSubtotalValue) {\r\n            const value = this.calculateSubtotal(\r\n              pivotData,\r\n              actualRowKey,\r\n              actualColKey,\r\n              pivotSettings\r\n            );\r\n            className = 'pvtSubtotal';\r\n\r\n            const tempAggregator = this.safeGetAggregator(pivotData, [], []);\r\n            aggregator = {\r\n              value: () => value,\r\n              format: tempAggregator ? tempAggregator.format : x => x,\r\n            };\r\n\r\n            if (opts.heatmapMode && colMapper.bgColorFromSubtotalValue) {\r\n              let cellColor;\r\n              if (opts.heatmapMode === 'full') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(value);\r\n              } else if (opts.heatmapMode === 'row') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  value,\r\n                  actualRowKey\r\n                );\r\n              } else if (opts.heatmapMode === 'col') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  value,\r\n                  actualRowKey,\r\n                  actualColKey\r\n                );\r\n              }\r\n\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          } else {\r\n            aggregator = this.safeGetAggregator(\r\n              pivotData,\r\n              actualRowKey,\r\n              actualColKey\r\n            );\r\n            className = 'pvtVal';\r\n\r\n            if (opts.heatmapMode && colMapper.bgColorFromRowColKey) {\r\n              const cellColor = colMapper.bgColorFromRowColKey(\r\n                actualRowKey,\r\n                actualColKey\r\n              );\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          }\r\n\r\n          if (!aggregator || aggregator.value() === null) {\r\n            cells.push(\r\n              <td className={className} key={`pvtVal-${i}`} style={valCss} />\r\n            );\r\n            return;\r\n          }\r\n\r\n          const val = aggregator.value();\r\n\r\n          let formattedVal;\r\n          if (val === null) {\r\n            formattedVal = '';\r\n          } else if (className === 'pvtSubtotal' && val === 0) {\r\n            formattedVal = '';\r\n          } else {\r\n            formattedVal = aggregator.format(val);\r\n          }\r\n\r\n          const cellKey = flatKey(actualRowKey);\r\n          const colCellKey = flatKey(actualColKey);\r\n\r\n          cells.push(\r\n            <td\r\n              className={className}\r\n              key={`pvtVal-${i}`}\r\n              style={valCss}\r\n              onClick={\r\n                cellCallbacks[cellKey] && colCellKey in cellCallbacks[cellKey]\r\n                  ? cellCallbacks[cellKey][colCellKey]\r\n                  : null\r\n              }\r\n            >\r\n              {formattedVal}\r\n            </td>\r\n          );\r\n        } catch (error) {\r\n          cells.push(<td className=\"pvtVal\" key={`pvtVal-${i}`} />);\r\n        }\r\n      });\r\n\r\n      if (rowTotals) {\r\n        try {\r\n          const className = isSubtotalRow ? 'pvtTotal pvtSubtotal' : 'pvtTotal';\r\n          let valCss = {};\r\n\r\n          let totalVal = 0;\r\n          let formattedTotal = '';\r\n\r\n          if (isSubtotalRow) {\r\n            totalVal = this.calculateSubtotal(\r\n              pivotData,\r\n              actualRowKey,\r\n              [],\r\n              pivotSettings\r\n            );\r\n\r\n            if (opts.heatmapMode && colMapper.bgColorFromSubtotalValue) {\r\n              let cellColor;\r\n              if (opts.heatmapMode === 'full') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(totalVal);\r\n              } else if (opts.heatmapMode === 'row') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey\r\n                );\r\n              } else if (opts.heatmapMode === 'col') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey,\r\n                  []\r\n                );\r\n              }\r\n\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          } else if (\r\n            actualRowKey.length < rowAttrs.length &&\r\n            this.state.collapsedRows[flatKey(actualRowKey)]\r\n          ) {\r\n            totalVal = this.calculateSubtotal(\r\n              pivotData,\r\n              actualRowKey,\r\n              [],\r\n              pivotSettings\r\n            );\r\n\r\n            if (opts.heatmapMode && colMapper.bgColorFromSubtotalValue) {\r\n              let cellColor;\r\n              if (opts.heatmapMode === 'full') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(totalVal);\r\n              } else if (opts.heatmapMode === 'row') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey\r\n                );\r\n              } else if (opts.heatmapMode === 'col') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey,\r\n                  []\r\n                );\r\n              }\r\n\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          } else {\r\n            pivotData.getColKeys().forEach(colKey => {\r\n              const agg = this.safeGetAggregator(\r\n                pivotData,\r\n                actualRowKey,\r\n                colKey\r\n              );\r\n              if (agg) {\r\n                const val = agg.value();\r\n                if (val !== null && !isNaN(val)) {\r\n                  totalVal += val;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (opts.heatmapMode && totalVal !== 0) {\r\n              if (\r\n                opts.heatmapMode === 'row' &&\r\n                colMapper.bgColorFromSubtotalValue\r\n              ) {\r\n                const cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  totalVal,\r\n                  actualRowKey\r\n                );\r\n                if (cellColor) {\r\n                  valCss = cellColor;\r\n                }\r\n              } else if (rowMapper.totalColor) {\r\n                const cellColor = rowMapper.totalColor(actualRowKey[0]);\r\n                if (cellColor) {\r\n                  valCss = cellColor;\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          if (totalVal !== 0 || isSubtotalRow) {\r\n            const tempAggregator = this.safeGetAggregator(pivotData, [], []);\r\n            const formatFunc =\r\n              tempAggregator && tempAggregator.format\r\n                ? tempAggregator.format\r\n                : x => x;\r\n            if (className.includes('pvtSubtotal') && totalVal === 0) {\r\n              formattedTotal = '';\r\n            } else {\r\n              formattedTotal =\r\n                totalVal === null || totalVal === 0 ? '' : formatFunc(totalVal);\r\n            }\r\n          }\r\n\r\n          const cellKey = flatKey(actualRowKey);\r\n\r\n          cells.push(\r\n            <td\r\n              className={className}\r\n              key=\"total\"\r\n              style={valCss}\r\n              onClick={rowTotalCallbacks[cellKey]}\r\n            >\r\n              {formattedTotal}\r\n            </td>\r\n          );\r\n        } catch (error) {\r\n          cells.push(<td className=\"pvtTotal\" key=\"total\" />);\r\n        }\r\n      }\r\n\r\n      return cells;\r\n    }\r\n\r\n    renderTotalsRow(pivotSettings) {\r\n      const {\r\n        colKeys,\r\n        colAttrs,\r\n        rowAttrs,\r\n        colTotals,\r\n        pivotData,\r\n        colMapper,\r\n        grandTotalCallback,\r\n        colTotalCallbacks,\r\n      } = pivotSettings;\r\n\r\n      const visibleColKeys = this.visibleKeys(\r\n        colKeys,\r\n        this.state.collapsedCols\r\n      );\r\n\r\n      const cells = [];\r\n      cells.push(\r\n        <th\r\n          key=\"labelTotal\"\r\n          className=\"pvtTotalLabel\"\r\n          colSpan={rowAttrs.length + (colAttrs.length === 0 ? 0 : 1)}\r\n        >\r\n          Totals\r\n        </th>\r\n      );\r\n\r\n      visibleColKeys.forEach((colKey, i) => {\r\n        try {\r\n          const isSubtotalCol = colKey[colKey.length - 1] === '__subtotal__';\r\n          const actualColKey = isSubtotalCol ? colKey.slice(0, -1) : colKey;\r\n\r\n          if (!actualColKey) {\r\n            cells.push(<td className=\"pvtTotal\" key={`total-${i}`} />);\r\n            return;\r\n          }\r\n\r\n          let colTotal = 0;\r\n\r\n          const flatColKey = flatKey(actualColKey);\r\n          const isCollapsedParent =\r\n            this.state.collapsedCols[flatColKey] &&\r\n            actualColKey.length < colAttrs.length;\r\n\r\n          if (isSubtotalCol || isCollapsedParent) {\r\n            colTotal = this.calculateSubtotal(\r\n              pivotData,\r\n              [],\r\n              actualColKey,\r\n              pivotSettings\r\n            );\r\n          } else {\r\n            pivotData.getRowKeys().forEach(rowKey => {\r\n              const agg = this.safeGetAggregator(\r\n                pivotData,\r\n                rowKey,\r\n                actualColKey\r\n              );\r\n              if (agg) {\r\n                const val = agg.value();\r\n                if (val !== null && !isNaN(val)) {\r\n                  colTotal += val;\r\n                }\r\n              }\r\n            });\r\n          }\r\n\r\n          let valCss = {};\r\n          if (isSubtotalCol || isCollapsedParent) {\r\n            if (opts.heatmapMode && colMapper.bgColorFromSubtotalValue) {\r\n              let cellColor;\r\n              if (opts.heatmapMode === 'full') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(colTotal);\r\n              } else if (opts.heatmapMode === 'row') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(colTotal, []);\r\n              } else if (opts.heatmapMode === 'col') {\r\n                cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  colTotal,\r\n                  [],\r\n                  actualColKey\r\n                );\r\n              }\r\n\r\n              if (cellColor) {\r\n                valCss = cellColor;\r\n              }\r\n            }\r\n          } else {\r\n            if (opts.heatmapMode && colTotal !== 0) {\r\n              if (\r\n                opts.heatmapMode === 'col' &&\r\n                colMapper.bgColorFromSubtotalValue\r\n              ) {\r\n                const cellColor = colMapper.bgColorFromSubtotalValue(\r\n                  colTotal,\r\n                  [],\r\n                  actualColKey\r\n                );\r\n                if (cellColor) {\r\n                  valCss = cellColor;\r\n                }\r\n              } else if (colMapper.totalColor) {\r\n                const cellColor = colMapper.totalColor(actualColKey[0]);\r\n                if (cellColor) {\r\n                  valCss = cellColor;\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          const tempAggregator = this.safeGetAggregator(pivotData, [], []);\r\n          const format =\r\n            tempAggregator && tempAggregator.format\r\n              ? tempAggregator.format\r\n              : x => x;\r\n\r\n          let displayValue;\r\n          if (colTotal === null || colTotal === 0) {\r\n            displayValue = '';\r\n          } else {\r\n            displayValue = format ? format(colTotal) : colTotal;\r\n          }\r\n\r\n          cells.push(\r\n            <td\r\n              className={`pvtTotal ${\r\n                isSubtotalCol || isCollapsedParent ? 'pvtSubtotal' : ''\r\n              }`}\r\n              key={`total-${i}`}\r\n              style={valCss}\r\n              onClick={colTotalCallbacks[flatKey(actualColKey)]}\r\n            >\r\n              {displayValue}\r\n            </td>\r\n          );\r\n        } catch (error) {\r\n          cells.push(<td className=\"pvtTotal\" key={`total-${i}`} />);\r\n        }\r\n      });\r\n\r\n      if (colTotals) {\r\n        try {\r\n          let grandTotal = 0;\r\n          let validValuesFound = false;\r\n\r\n          try {\r\n            const grandTotalAggregator = pivotData.getAggregator([], []);\r\n            if (grandTotalAggregator) {\r\n              const val = grandTotalAggregator.value();\r\n              if (val !== null && !isNaN(val)) {\r\n                grandTotal = val;\r\n                validValuesFound = true;\r\n              }\r\n            }\r\n          } catch (e) {\r\n            // Error getting grand total directly, will calculate manually\r\n          }\r\n\r\n          if (!validValuesFound) {\r\n            pivotData.getRowKeys().forEach(rowKey => {\r\n              pivotData.getColKeys().forEach(colKey => {\r\n                try {\r\n                  const agg = this.safeGetAggregator(pivotData, rowKey, colKey);\r\n                  if (agg) {\r\n                    const val = agg.value();\r\n                    if (val !== null && !isNaN(val)) {\r\n                      grandTotal += val;\r\n                      validValuesFound = true;\r\n                    }\r\n                  }\r\n                } catch (e) {\r\n                  // Ignore errors for missing combinations\r\n                }\r\n              });\r\n            });\r\n          }\r\n\r\n          const tempAggregator = this.safeGetAggregator(pivotData, [], []);\r\n          const format =\r\n            tempAggregator && tempAggregator.format\r\n              ? tempAggregator.format\r\n              : x => x;\r\n\r\n          cells.push(\r\n            <td\r\n              className=\"pvtGrandTotal\"\r\n              key=\"grandTotal\"\r\n              style={\r\n                opts.heatmapMode && colMapper.grandTotalColor\r\n                  ? colMapper.grandTotalColor\r\n                  : {}\r\n              }\r\n              onClick={grandTotalCallback}\r\n            >\r\n              {validValuesFound && grandTotal !== 0\r\n                ? format\r\n                  ? format(grandTotal)\r\n                  : grandTotal\r\n                : ''}\r\n            </td>\r\n          );\r\n        } catch (error) {\r\n          cells.push(<td className=\"pvtGrandTotal\" key=\"grandTotal\" />);\r\n        }\r\n      }\r\n\r\n      return cells;\r\n    }\r\n\r\n    visibleKeys(keys, collapsed) {\r\n      if (!opts.subtotals) {\r\n        return keys;\r\n      }\r\n\r\n      const sortedKeys = keys.slice().sort((a, b) => {\r\n        const minLength = Math.min(a.length, b.length);\r\n        for (let i = 0; i < minLength; i++) {\r\n          const aStr = String(a[i]);\r\n          const bStr = String(b[i]);\r\n          const cmp = aStr.localeCompare(bStr);\r\n          if (cmp !== 0) {\r\n            return cmp;\r\n          }\r\n        }\r\n        return a.length - b.length;\r\n      });\r\n\r\n      const result = [];\r\n      const processedKeys = new Set();\r\n\r\n      for (const key of sortedKeys) {\r\n        let parentCollapsed = false;\r\n        let deepestCollapsedParent = null;\r\n\r\n        for (let i = 0; i < key.length; i++) {\r\n          const parentKey = key.slice(0, i + 1);\r\n          const flatParentKey = flatKey(parentKey);\r\n          if (collapsed[flatParentKey]) {\r\n            parentCollapsed = true;\r\n            deepestCollapsedParent = parentKey;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (parentCollapsed) {\r\n          const flatParentKey = flatKey(deepestCollapsedParent);\r\n          if (!processedKeys.has(flatParentKey)) {\r\n            result.push(deepestCollapsedParent);\r\n            processedKeys.add(flatParentKey);\r\n          }\r\n        } else {\r\n          const flatKey_ = flatKey(key);\r\n          if (!processedKeys.has(flatKey_)) {\r\n            result.push(key);\r\n            processedKeys.add(flatKey_);\r\n          }\r\n        }\r\n      }\r\n\r\n      const finalResult = [];\r\n      const addedSubtotals = new Set();\r\n\r\n      const parentGroups = new Map();\r\n      for (const key of result) {\r\n        for (let level = 1; level < key.length; level++) {\r\n          const parentKey = key.slice(0, level);\r\n          const parentKeyStr = flatKey(parentKey);\r\n\r\n          if (!parentGroups.has(parentKeyStr)) {\r\n            parentGroups.set(parentKeyStr, {\r\n              key: parentKey,\r\n              level: level,\r\n              lastChildIndex: -1,\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let i = 0; i < result.length; i++) {\r\n        const key = result[i];\r\n        for (let level = 1; level < key.length; level++) {\r\n          const parentKey = key.slice(0, level);\r\n          const parentKeyStr = flatKey(parentKey);\r\n          const parentGroup = parentGroups.get(parentKeyStr);\r\n\r\n          if (parentGroup) {\r\n            parentGroup.lastChildIndex = Math.max(\r\n              parentGroup.lastChildIndex,\r\n              i\r\n            );\r\n          }\r\n        }\r\n      }\r\n\r\n      for (let i = 0; i < result.length; i++) {\r\n        const key = result[i];\r\n        finalResult.push(key);\r\n\r\n        const subtotalsToAdd = [];\r\n\r\n        for (let level = key.length - 1; level >= 1; level--) {\r\n          const parentKey = key.slice(0, level);\r\n          const parentKeyStr = flatKey(parentKey);\r\n          const parentGroup = parentGroups.get(parentKeyStr);\r\n\r\n          if (collapsed[parentKeyStr]) {\r\n            continue;\r\n          }\r\n\r\n          if (parentGroup && parentGroup.lastChildIndex === i) {\r\n            const subtotalKey = [...parentKey, '__subtotal__'];\r\n            const subtotalKeyStr = flatKey(subtotalKey);\r\n\r\n            if (!addedSubtotals.has(subtotalKeyStr)) {\r\n              subtotalsToAdd.push(subtotalKey);\r\n              addedSubtotals.add(subtotalKeyStr);\r\n            }\r\n          }\r\n        }\r\n\r\n        finalResult.push(...subtotalsToAdd);\r\n      }\r\n\r\n      return finalResult;\r\n    }\r\n\r\n    getSubtotal(rowKey, colKey, pivotSettings) {\r\n      const {pivotData} = pivotSettings;\r\n      return pivotData.getAggregator(rowKey, colKey).value();\r\n    }\r\n\r\n    hasSubtotals(rowOrCol, key, pivotSettings) {\r\n      const {rowAttrs, colAttrs} = pivotSettings;\r\n      const attrs = rowOrCol === 'row' ? rowAttrs : colAttrs;\r\n\r\n      return key.length < attrs.length;\r\n    }\r\n\r\n    safeGetAggregator(pivotData, rowKey, colKey) {\r\n      try {\r\n        return pivotData.getAggregator(rowKey, colKey);\r\n      } catch (error) {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    calculateSubtotal(pivotData, rowKey, colKey, pivotSettings) {\r\n      const {rowAttrs, colAttrs} = pivotSettings;\r\n\r\n      if (\r\n        rowKey.length === rowAttrs.length &&\r\n        colKey.length === colAttrs.length\r\n      ) {\r\n        const agg = this.safeGetAggregator(pivotData, rowKey, colKey);\r\n        return agg ? agg.value() : 0;\r\n      }\r\n\r\n      let total = 0;\r\n      let hasValidValues = false;\r\n\r\n      const childRowKeys = [];\r\n      if (rowKey.length < rowAttrs.length) {\r\n        pivotData.getRowKeys().forEach(fullRowKey => {\r\n          let isChild = true;\r\n          for (let i = 0; i < rowKey.length; i++) {\r\n            if (fullRowKey[i] !== rowKey[i]) {\r\n              isChild = false;\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (isChild) {\r\n            childRowKeys.push(fullRowKey);\r\n          }\r\n        });\r\n      } else {\r\n        childRowKeys.push(rowKey);\r\n      }\r\n\r\n      const childColKeys = [];\r\n      if (colKey.length < colAttrs.length) {\r\n        pivotData.getColKeys().forEach(fullColKey => {\r\n          let isChild = true;\r\n          for (let i = 0; i < colKey.length; i++) {\r\n            if (fullColKey[i] !== colKey[i]) {\r\n              isChild = false;\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (isChild) {\r\n            childColKeys.push(fullColKey);\r\n          }\r\n        });\r\n      } else {\r\n        childColKeys.push(colKey);\r\n      }\r\n\r\n      if (childRowKeys.length === 0 || childColKeys.length === 0) {\r\n        const agg = this.safeGetAggregator(pivotData, rowKey, colKey);\r\n        return agg ? agg.value() || 0 : 0;\r\n      }\r\n\r\n      childRowKeys.forEach(childRowKey => {\r\n        childColKeys.forEach(childColKey => {\r\n          const agg = this.safeGetAggregator(\r\n            pivotData,\r\n            childRowKey,\r\n            childColKey\r\n          );\r\n          if (agg) {\r\n            const val = agg.value();\r\n            if (val !== null && !isNaN(val)) {\r\n              total += val;\r\n              hasValidValues = true;\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n      return hasValidValues ? total : 0;\r\n    }\r\n\r\n    render() {\r\n      const pivotSettings = this.getBasePivotSettings();\r\n      const {colAttrs, rowAttrs, rowKeys, colKeys, rowTotals} = pivotSettings;\r\n\r\n      const renderedLabels = {};\r\n\r\n      const visibleRowKeys = opts.subtotals\r\n        ? this.visibleKeys(rowKeys, this.state.collapsedRows)\r\n        : rowKeys;\r\n      const visibleColKeys = opts.subtotals\r\n        ? this.visibleKeys(colKeys, this.state.collapsedCols)\r\n        : colKeys;\r\n\r\n      const finalPivotSettings = Object.assign(\r\n        {\r\n          visibleRowKeys,\r\n          maxRowVisible: Math.max(...visibleRowKeys.map(k => k.length)),\r\n          visibleColKeys,\r\n          maxColVisible: Math.max(...visibleColKeys.map(k => k.length)),\r\n          rowAttrSpans: this.calcAttrSpans(visibleRowKeys, rowAttrs.length),\r\n          colAttrSpans: this.calcAttrSpans(visibleColKeys, colAttrs.length),\r\n        },\r\n        pivotSettings\r\n      );\r\n\r\n      const rowspans = {};\r\n      visibleRowKeys.forEach((rowKey, rowIdx) => {\r\n        const isSubtotalRow = rowKey[rowKey.length - 1] === '__subtotal__';\r\n        const actualRowKey = isSubtotalRow ? rowKey.slice(0, -1) : rowKey;\r\n\r\n        for (let level = 0; level < actualRowKey.length; level++) {\r\n          const cellKey = `${rowIdx}-${level}`;\r\n\r\n          let span = 1;\r\n          let j = rowIdx + 1;\r\n          while (j < visibleRowKeys.length) {\r\n            const nextKey = visibleRowKeys[j];\r\n            const isNextSubtotal =\r\n              nextKey[nextKey.length - 1] === '__subtotal__';\r\n            const actualNextKey = isNextSubtotal\r\n              ? nextKey.slice(0, -1)\r\n              : nextKey;\r\n\r\n            if (level >= actualNextKey.length) {\r\n              break;\r\n            }\r\n\r\n            let matches = true;\r\n            for (let l = 0; l <= level; l++) {\r\n              if (\r\n                l >= actualNextKey.length ||\r\n                actualNextKey[l] !== actualRowKey[l]\r\n              ) {\r\n                matches = false;\r\n                break;\r\n              }\r\n            }\r\n\r\n            if (!matches) {\r\n              break;\r\n            }\r\n            span++;\r\n            j++;\r\n          }\r\n\r\n          rowspans[cellKey] = span;\r\n        }\r\n      });\r\n\r\n      const renderedRows = visibleRowKeys.map((rowKey, i) => {\r\n        const rowCells = [];\r\n\r\n        const isSubtotalRow = rowKey[rowKey.length - 1] === '__subtotal__';\r\n        const actualRowKey = isSubtotalRow ? rowKey.slice(0, -1) : rowKey;\r\n\r\n        if (isSubtotalRow) {\r\n          rowCells.push(\r\n            <th\r\n              key=\"subtotalLabel\"\r\n              className=\"pvtRowLabel pvtSubtotal\"\r\n              colSpan={rowAttrs.length - actualRowKey.length + 1}\r\n            />\r\n          );\r\n        } else {\r\n          for (let level = 0; level < actualRowKey.length; level++) {\r\n            const labelKey = `${actualRowKey.slice(0, level + 1).join('|')}`;\r\n\r\n            if (!renderedLabels[labelKey]) {\r\n              renderedLabels[labelKey] = true;\r\n\r\n              const cellKey = `${i}-${level}`;\r\n              const rowspan = rowspans[cellKey] || 1;\r\n\r\n              const flatRowKey = flatKey(actualRowKey.slice(0, level + 1));\r\n              const isCollapsed = this.state.collapsedRows[flatRowKey];\r\n\r\n              let className = 'pvtRowLabel';\r\n\r\n              let icon = null;\r\n\r\n              if (level + 1 < rowAttrs.length) {\r\n                if (isCollapsed) {\r\n                  className += ' collapsed';\r\n                  icon = pivotSettings.arrowCollapsed;\r\n                } else {\r\n                  className += ' expanded';\r\n                  icon = pivotSettings.arrowExpanded;\r\n                }\r\n                rowCells.push(\r\n                  <th\r\n                    key={`rowLabel-${level}`}\r\n                    className={className}\r\n                    rowSpan={rowspan}\r\n                    onClick={this.toggleRowKey(flatRowKey)}\r\n                    style={{cursor: 'pointer'}}\r\n                  >\r\n                    {icon && (\r\n                      <span className=\"pvtAttr\" style={{marginRight: '6px'}}>\r\n                        {icon}\r\n                      </span>\r\n                    )}\r\n                    <span>{actualRowKey[level]}</span>\r\n                  </th>\r\n                );\r\n                continue;\r\n              }\r\n\r\n              const isLeafLevel =\r\n                level === actualRowKey.length - 1 &&\r\n                actualRowKey.length === rowAttrs.length;\r\n              const leafColspan = isLeafLevel ? 2 : 1;\r\n\r\n              rowCells.push(\r\n                <th\r\n                  key={`rowLabel-${level}`}\r\n                  className={className}\r\n                  rowSpan={rowspan}\r\n                  colSpan={leafColspan}\r\n                  onClick={this.toggleRowKey(flatRowKey)}\r\n                >\r\n                  {icon && <span className=\"pvtAttr\">{icon}</span>}\r\n                  <span>{actualRowKey[level]}</span>\r\n                </th>\r\n              );\r\n            }\r\n          }\r\n\r\n          if (actualRowKey.length < rowAttrs.length) {\r\n            rowCells.push(\r\n              <th\r\n                key=\"padding\"\r\n                className=\"pvtRowLabel\"\r\n                colSpan={rowAttrs.length - actualRowKey.length + 1}\r\n              />\r\n            );\r\n          }\r\n        }\r\n\r\n        const dataCells = this.renderTableRow(rowKey, i, finalPivotSettings);\r\n\r\n        return (\r\n          <tr\r\n            key={`row-${i}`}\r\n            className={isSubtotalRow && opts.subtotals ? 'pvtSubtotalRow' : ''}\r\n          >\r\n            {rowCells}\r\n            {dataCells}\r\n          </tr>\r\n        );\r\n      });\r\n\r\n      const colAttrsHeaders = colAttrs.map((attrName, i) => {\r\n        return (\r\n          <tr key={`colAttr-${i}`}>\r\n            {this.renderColHeaderRow(attrName, i, finalPivotSettings)}\r\n          </tr>\r\n        );\r\n      });\r\n\r\n      let rowAttrsHeader = null;\r\n      if (rowAttrs.length > 0) {\r\n        rowAttrsHeader = (\r\n          <tr key=\"rowAttr-0\">{this.renderRowHeaderRow(finalPivotSettings)}</tr>\r\n        );\r\n      }\r\n\r\n      let totalHeader = null;\r\n      if (rowTotals) {\r\n        totalHeader = (\r\n          <tr key=\"total\">{this.renderTotalsRow(finalPivotSettings)}</tr>\r\n        );\r\n      }\r\n\r\n      return (\r\n        <table className=\"pvtTable\">\r\n          <thead>\r\n            {colAttrsHeaders}\r\n            {rowAttrsHeader}\r\n          </thead>\r\n          <tbody>\r\n            {renderedRows}\r\n            {totalHeader}\r\n          </tbody>\r\n        </table>\r\n      );\r\n    }\r\n  }\r\n\r\n  SubtotalRenderer.defaultProps = Object.assign({}, PivotData.defaultProps, {\r\n    tableColorScaleGenerator: redColorScaleGenerator,\r\n    tableOptions: {},\r\n  });\r\n  SubtotalRenderer.propTypes = Object.assign({}, PivotData.propTypes, {\r\n    tableColorScaleGenerator: PropTypes.func,\r\n    tableOptions: PropTypes.object,\r\n  });\r\n  return SubtotalRenderer;\r\n}\r\n\r\nclass TSVExportRenderer extends React.PureComponent {\r\n  render() {\r\n    const pivotData = new PivotData(this.props);\r\n    const rowKeys = pivotData.getRowKeys();\r\n    const colKeys = pivotData.getColKeys();\r\n    if (rowKeys.length === 0) {\r\n      rowKeys.push([]);\r\n    }\r\n    if (colKeys.length === 0) {\r\n      colKeys.push([]);\r\n    }\r\n\r\n    const headerRow = pivotData.props.rows.map(r => r);\r\n    if (colKeys.length === 1 && colKeys[0].length === 0) {\r\n      headerRow.push(this.props.aggregatorName);\r\n    } else {\r\n      colKeys.map(c => headerRow.push(c.join('-')));\r\n    }\r\n\r\n    const result = rowKeys.map(r => {\r\n      const row = r.map(x => x);\r\n      colKeys.map(c => {\r\n        const aggregator = pivotData.getAggregator(r, c);\r\n        row.push(aggregator.value());\r\n      });\r\n      return row;\r\n    });\r\n\r\n    result.unshift(headerRow);\r\n\r\n    return (\r\n      <textarea\r\n        value={result.map(r => r.join('\\t')).join('\\n')}\r\n        style={{width: window.innerWidth / 2, height: window.innerHeight / 2}}\r\n        readOnly={true}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nTSVExportRenderer.defaultProps = PivotData.defaultProps;\r\nTSVExportRenderer.propTypes = PivotData.propTypes;\r\n\r\nexport default {\r\n  'Table With Subtotal': makeRenderer({subtotals: true}),\r\n  'Heatmap With Subtotal': makeRenderer({\r\n    heatmapMode: 'full',\r\n    subtotals: true,\r\n  }),\r\n  'Col Heatmap With Subtotal': makeRenderer({\r\n    heatmapMode: 'col',\r\n    subtotals: true,\r\n  }),\r\n  'Row Heatmap With Subtotal': makeRenderer({\r\n    heatmapMode: 'row',\r\n    subtotals: true,\r\n  }),\r\n  'Exportable TSV': TSVExportRenderer,\r\n};\r\n"]}